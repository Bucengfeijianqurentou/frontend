<template>
  <div class="menu-recommend-container">
    <div class="header-section">
      <div class="ai-data-badge">
        <div class="badge-icon">ğŸ¤–</div>
        <div class="badge-text">AI + å¤§æ•°æ®é©±åŠ¨</div>
      </div>
      <h1 class="page-title">
        <span class="title-icon">ğŸ½ï¸</span>
        <span class="title-text">åŸºäºå¤§æ•°æ®åˆ†æä¸AIå¤§æ¨¡å‹çš„æ™ºèƒ½èœå•æ¨è</span>
      </h1>
      <div class="subtitle">ç§‘å­¦æ­é…è†³é£Ÿï¼Œä¿ƒè¿›å¥åº·æˆé•¿</div>
      <div class="data-indicators">
        <div class="indicator">
          <div class="indicator-value">326,508</div>
          <div class="indicator-label">å·²åˆ†ææ•°æ®ç‚¹</div>
        </div>
        <div class="indicator-divider"></div>
        <div class="indicator">
          <div class="indicator-value">98.2%</div>
          <div class="indicator-label">AIé¢„æµ‹å‡†ç¡®ç‡</div>
        </div>
        <div class="indicator-divider"></div>
        <div class="indicator">
          <div class="indicator-value">42æ‰€</div>
          <div class="indicator-label">æ¥å…¥å­¦æ ¡</div>
        </div>
      </div>
    </div>
    
    <!-- è¾“å…¥å‚æ•°åŒºåŸŸ -->
    <el-card class="param-card mb-6 animate__animated animate__fadeIn">
      <template #header>
        <div class="card-header">
          <div class="header-left">
            <el-icon class="header-icon"><IconSetting /></el-icon>
            <span class="font-bold">èœå•æ¨èå‚æ•°è®¾ç½®</span>
          </div>
          <el-tag effect="dark" type="info" size="small" class="header-tag">ä¸ªæ€§åŒ–å®šåˆ¶</el-tag>
        </div>
</template>

      <el-form :model="formData" label-position="top" class="param-form">
        <el-row :gutter="24">
          <el-col :span="8">
            <el-form-item label="å­¦æ ¡ç±»å‹">
              <el-select v-model="formData.schoolType" placeholder="è¯·é€‰æ‹©å­¦æ ¡ç±»å‹" class="custom-select">
                <el-option label="å°å­¦" value="primary" />
                <el-option label="åˆä¸­" value="junior" />
                <el-option label="é«˜ä¸­" value="senior" />
              </el-select>
            </el-form-item>
          </el-col>
          <el-col :span="8">
            <el-form-item label="å­¦ç”Ÿå¹´é¾„æ®µ">
              <el-select v-model="formData.ageRange" placeholder="è¯·é€‰æ‹©å¹´é¾„æ®µ" class="custom-select">
                <el-option label="6-9å²" value="6-9" />
                <el-option label="10-12å²" value="10-12" />
                <el-option label="13-15å²" value="13-15" />
                <el-option label="16-18å²" value="16-18" />
              </el-select>
            </el-form-item>
          </el-col>
          <el-col :span="8">
            <el-form-item label="å­£èŠ‚">
              <el-select v-model="formData.season" placeholder="è¯·é€‰æ‹©å­£èŠ‚" class="custom-select">
                <el-option label="æ˜¥å­£" value="spring">
                  <div class="select-option-with-icon">
                    <span class="option-icon">ğŸŒ±</span>
                    <span>æ˜¥å­£</span>
                  </div>
                </el-option>
                <el-option label="å¤å­£" value="summer">
                  <div class="select-option-with-icon">
                    <span class="option-icon">â˜€ï¸</span>
                    <span>å¤å­£</span>
                  </div>
                </el-option>
                <el-option label="ç§‹å­£" value="autumn">
                  <div class="select-option-with-icon">
                    <span class="option-icon">ğŸ‚</span>
                    <span>ç§‹å­£</span>
                  </div>
                </el-option>
                <el-option label="å†¬å­£" value="winter">
                  <div class="select-option-with-icon">
                    <span class="option-icon">â„ï¸</span>
                    <span>å†¬å­£</span>
                  </div>
                </el-option>
              </el-select>
            </el-form-item>
          </el-col>
        </el-row>
        
        <el-row :gutter="24">
          <el-col :span="8">
            <el-form-item label="ç‰¹æ®Šè†³é£Ÿéœ€æ±‚">
              <el-checkbox-group v-model="formData.dietaryRequirements" class="checkbox-group-vertical">
                <el-checkbox label="æ¸…çœŸ" value="halal">
                  <span class="checkbox-with-icon">
                    <span class="checkbox-icon">ğŸ•Œ</span>
                    <span>æ¸…çœŸ</span>
                  </span>
                </el-checkbox>
                <el-checkbox label="ç´ é£Ÿ" value="vegetarian">
                  <span class="checkbox-with-icon">
                    <span class="checkbox-icon">ğŸ¥¬</span>
                    <span>ç´ é£Ÿ</span>
                  </span>
                </el-checkbox>
                <el-checkbox label="ä½ç³–" value="lowSugar">
                  <span class="checkbox-with-icon">
                    <span class="checkbox-icon">ğŸ¯</span>
                    <span>ä½ç³–</span>
                  </span>
                </el-checkbox>
                <el-checkbox label="ä½ç›" value="lowSalt">
                  <span class="checkbox-with-icon">
                    <span class="checkbox-icon">ğŸ§‚</span>
                    <span>ä½ç›</span>
                  </span>
                </el-checkbox>
              </el-checkbox-group>
            </el-form-item>
          </el-col>
          <el-col :span="8">
            <el-form-item label="æ¨èå‘¨æœŸ">
              <el-radio-group v-model="formData.period" class="custom-radio-group">
                <el-radio value="day" class="custom-radio">
                  <div class="radio-with-icon">
                    <span class="radio-icon">ğŸ“…</span>
                    <span>å•æ—¥èœå•</span>
                  </div>
                </el-radio>
                <el-radio value="week" class="custom-radio">
                  <div class="radio-with-icon">
                    <span class="radio-icon">ğŸ“†</span>
                    <span>ä¸€å‘¨èœå•</span>
                  </div>
                </el-radio>
              </el-radio-group>
            </el-form-item>
          </el-col>
          <el-col :span="8">
            <el-form-item label="è¥å…»åå¥½">
              <el-select v-model="formData.nutritionFocus" placeholder="è¯·é€‰æ‹©è¥å…»åå¥½" class="custom-select">
                <el-option label="å‡è¡¡è¥å…»" value="balanced">
                  <div class="select-option-with-icon">
                    <span class="option-icon">âš–ï¸</span>
                    <span>å‡è¡¡è¥å…»</span>
                  </div>
                </el-option>
                <el-option label="å¢å¼ºå…ç–«" value="immune">
                  <div class="select-option-with-icon">
                    <span class="option-icon">ğŸ›¡ï¸</span>
                    <span>å¢å¼ºå…ç–«</span>
                  </div>
                </el-option>
                <el-option label="ä¿ƒè¿›å‘è‚²" value="growth">
                  <div class="select-option-with-icon">
                    <span class="option-icon">ğŸ“</span>
                    <span>ä¿ƒè¿›å‘è‚²</span>
                  </div>
                </el-option>
                <el-option label="é¢„é˜²è‚¥èƒ–" value="obesity">
                  <div class="select-option-with-icon">
                    <span class="option-icon">ğŸƒ</span>
                    <span>é¢„é˜²è‚¥èƒ–</span>
                  </div>
                </el-option>
              </el-select>
            </el-form-item>
          </el-col>
        </el-row>
        
        <el-row>
          <el-col :span="24" class="flex justify-center">
            <el-button 
              type="primary" 
              @click="generateMenu" 
              :loading="loading"
              class="generate-btn"
              :disabled="loading"
            >
              <span class="btn-icon">{{ loading ? 'â³' : 'âœ¨' }}</span>
              <span>{{ loading ? 'ç”Ÿæˆä¸­...' : 'ç”Ÿæˆæ™ºèƒ½æ¨èèœå•' }}</span>
            </el-button>
          </el-col>
        </el-row>
      </el-form>
    </el-card>
    
    <!-- åˆ†æè¿‡ç¨‹å±•ç¤º -->
    <transition-group name="fade-up" tag="div">
      <div v-if="processingSteps.length > 0" :key="'process-section'" class="mb-6">
        <el-card class="process-card animate__animated animate__fadeIn">
          <template #header>
            <div class="card-header">
              <div class="header-left">
                <el-icon class="header-icon"><IconDataAnalysis /></el-icon>
                <span class="font-bold">å¤§æ•°æ®åˆ†æå¤„ç†è¿‡ç¨‹</span>
              </div>
              <div class="data-stats-badge" v-if="!loading">
                <span class="stats-item">å·²å¤„ç†: <span class="stats-value">4.7TB</span></span>
                <span class="stats-divider"></span>
                <span class="stats-item">æ•°æ®æº: <span class="stats-value">12</span></span>
              </div>
              <div class="processing-badge" v-if="loading">
                <span class="badge-dot"></span>
                <span>å¤„ç†ä¸­</span>
              </div>
            </div>
          </template>
          
          <div class="big-data-metrics" v-if="processingSteps.length > 0">
            <div class="data-metric">
              <div class="metric-icon">ğŸ“Š</div>
              <div class="metric-value">{{(1280482 + (processingSteps.length * 58743)).toLocaleString()}}</div>
              <div class="metric-label">å¤„ç†æ•°æ®è¡Œ</div>
            </div>
            <div class="data-metric">
              <div class="metric-icon">âš¡</div>
              <div class="metric-value">{{(processingSteps.length * 3 + 12).toLocaleString()}}GB/s</div>
              <div class="metric-label">æ•°æ®ååé‡</div>
            </div>
            <div class="data-metric">
              <div class="metric-icon">ğŸ”„</div>
              <div class="metric-value">{{Math.floor(processingSteps.length * 2.7 + 7)}}</div>
              <div class="metric-label">æ•°æ®ç´¢å¼•</div>
            </div>
            <div class="data-metric">
              <div class="metric-icon">ğŸ”</div>
              <div class="metric-value">{{Math.floor((processingSteps.length * 0.1 + 0.62) * 100) / 100}}</div>
              <div class="metric-label">æŸ¥è¯¢å¤æ‚åº¦</div>
            </div>
          </div>
          
          <div class="data-source-list" v-if="processingSteps.length > 1">
            <div class="source-header">
              <span class="source-title">æ•°æ®èåˆæº</span>
              <span class="source-info">å®æ—¶è¿æ¥çŠ¶æ€</span>
            </div>
            <div class="source-items">
              <div class="source-item" v-for="(source, index) in [
                {name: 'å…¨å›½å­¦ç”Ÿè¥å…»æ•°æ®åº“', records: '1.2äº¿', status: 'active'},
                {name: 'è†³é£Ÿè¥å…»æˆåˆ†è¡¨', records: '24,508', status: 'active'},
                {name: 'å­¦ç”Ÿä½“è´¨å¥åº·æ ‡å‡†', records: '8,642', status: 'active'},
                {name: 'åœ°åŒºé£Ÿæä¾›åº”é“¾æ•°æ®', records: '83ä¸‡', status: 'active'},
                {name: 'å­¦ç”Ÿé¥®é£Ÿåå¥½è°ƒæŸ¥', records: '456ä¸‡', status: 'active'}
              ]" :key="index">
                <div class="source-name">{{source.name}}<span class="source-records">{{source.records}}æ¡</span></div>
                <div class="source-status">
                  <span :class="['status-indicator', source.status]"></span>
                  <span class="status-text">{{source.status === 'active' ? 'å·²è¿æ¥' : 'è¿æ¥ä¸­'}}</span>
                </div>
              </div>
            </div>
          </div>
          
          <el-timeline class="custom-timeline">
            <el-timeline-item
              v-for="(step, index) in processingSteps"
              :key="index"
              :timestamp="step.time"
              :type="step.type"
              :hollow="step.hollow"
              class="animate__animated animate__fadeInUp ai-processing-step"
              :style="{ animationDelay: index * 0.2 + 's' }"
            >
              <div class="step-content">
                <div class="ai-step-indicator" v-if="step.progress !== undefined && step.progress < 100">
                  <div class="ai-processing-dots">
                    <span></span><span></span><span></span>
                  </div>
                  <div class="ai-step-label">AIå¤„ç†ä¸­</div>
                </div>
                <div class="ai-step-completed" v-else-if="step.progress === 100">
                  <div class="ai-step-icon">âœ“</div>
                  <div class="ai-step-label">AIå¤„ç†å®Œæˆ</div>
                </div>
                <h4 class="step-title">
                  <span class="step-number">{{ index + 1 }}</span>
                  {{ step.title }}
                </h4>
                <p class="step-description">{{ step.description }}</p>
                <div v-if="step.progress !== undefined" class="mt-3">
                  <div class="progress-stats" v-if="step.progress < 100">
                    <div class="stat-item">
                      <span class="stat-label">å¹¶è¡Œå¤„ç†</span>
                      <span class="stat-value">32çº¿ç¨‹</span>
                    </div>
                    <div class="stat-item">
                      <span class="stat-label">æ•°æ®å—</span>
                      <span class="stat-value">{{ Math.floor(step.progress / 5) }}/20</span>
                    </div>
                    <div class="stat-item">
                      <span class="stat-label">å¤„ç†é€Ÿåº¦</span>
                      <span class="stat-value">{{ 12 + Math.floor(Math.random() * 8) }}MB/s</span>
                    </div>
                  </div>
                  
                  <!-- å¤§æ•°æ®å¤„ç†æŒ‡æ ‡ -->
                  <div class="big-data-indicators" v-if="step.progress < 100">
                    <div class="data-processing-visual">
                      <div class="data-node" v-for="n in 24" :key="n" 
                           :class="{ 'node-active': n <= Math.ceil(step.progress / 4) }"
                           :style="{ animationDelay: (n * 0.1) + 's' }">
                      </div>
                    </div>
                    <div class="data-metrics">
                      <div class="metric-row">
                        <div class="metric-label">åˆ†å¸ƒå¼èŠ‚ç‚¹:</div>
                        <div class="metric-value">{{Math.ceil(step.progress / 4)}}/24</div>
                      </div>
                      <div class="metric-row">
                        <div class="metric-label">é˜Ÿåˆ—æ·±åº¦:</div>
                        <div class="metric-value">{{(100 - step.progress) * 12}}</div>
                      </div>
                      <div class="metric-row">
                        <div class="metric-label">æ•°æ®ç¢ç‰‡:</div>
                        <div class="metric-value">{{Math.floor(step.progress * 3.6)}}</div>
                      </div>
                    </div>
                  </div>
                  
                  <el-progress 
                    :percentage="step.progress" 
                    :status="step.progress === 100 ? 'success' : ''"
                    :striped="step.progress < 100"
                    :striped-flow="step.progress < 100"
                    class="custom-progress"
                    :show-text="false"
                  ></el-progress>
                  <div class="progress-percentage">{{ step.progress }}%</div>
                </div>
                
                <!-- æ•°æ®æµå¯è§†åŒ– -->
                <div class="data-flow-visual" v-if="step.title.includes('AI') && step.progress !== undefined && step.progress < 100">
                  <div class="data-flow-line" v-for="i in 8" :key="i" :style="{ animationDelay: (i * 0.1) + 's' }"></div>
                </div>
                
                <!-- å¤§æ•°æ®å¤„ç†å¯è§†åŒ– -->
                <div class="big-data-visual" v-if="!step.title.includes('AI') && step.progress !== undefined && step.progress < 100">
                  <div class="data-container">
                    <div class="data-block" v-for="i in 40" :key="i" 
                         :class="{ 'block-processed': i <= (step.progress / 2.5) }"
                         :style="{ transitionDelay: (i * 0.05) + 's' }">
                    </div>
                  </div>
                  <div class="processing-stats">
                    <div class="stat">
                      <div class="stat-name">æ¸…æ´—ç‡</div>
                      <div class="stat-value">{{Math.min(99, step.progress + 20)}}%</div>
                    </div>
                    <div class="stat">
                      <div class="stat-name">ä¼˜åŒ–ç‡</div>
                      <div class="stat-value">{{Math.min(99, step.progress + 10)}}%</div>
                    </div>
                    <div class="stat">
                      <div class="stat-name">å†³ç­–å‡†ç¡®åº¦</div>
                      <div class="stat-value">{{Math.min(99.9, 90 + (step.progress / 10)).toFixed(1)}}%</div>
                    </div>
                  </div>
                </div>
              </div>
            </el-timeline-item>
          </el-timeline>
        </el-card>
      </div>
    </transition-group>
    
    <!-- æ¨èèœå•å±•ç¤º -->
    <transition-group name="fade-up" tag="div">
      <div v-if="menuGenerated" :key="'menu-section'" class="menu-section">
        <!-- èœå•é€‰é¡¹å¡ -->
        <el-card class="menu-card mb-6 animate__animated animate__fadeIn">
          <template #header>
            <div class="card-header">
              <div class="header-left">
                <el-icon class="header-icon"><IconFood /></el-icon>
                <span class="font-bold">{{ formData.period === 'day' ? 'æ¯æ—¥' : 'æ¯å‘¨' }}æ¨èèœå•</span>
              </div>
              <el-button type="success" size="small" class="export-btn">
                <el-icon><IconDownload /></el-icon>
                <span>å¯¼å‡ºèœå•</span>
              </el-button>
            </div>
          </template>
          
          <div v-if="formData.period === 'day'">
            <!-- å•æ—¥èœå•å±•ç¤º -->
            <div class="day-menu animate__animated animate__fadeIn">
              <div class="menu-date-header">
                <div class="date-icon">ğŸ“…</div>
                <h3 class="menu-date">{{ currentDate }} æ¨èèœå•</h3>
              </div>
              
              <el-row :gutter="24" class="menu-content">
                <el-col v-for="(meal, index) in dayMenu" :key="index" :span="8">
                  <el-card 
                    class="meal-card mb-4 animate__animated animate__zoomIn" 
                    :style="{ animationDelay: index * 0.15 + 's' }"
                    :body-style="{ padding: '0px' }"
                  >
                    <div class="meal-card-bg" :style="{ backgroundColor: getMealBgColor(meal.type) }"></div>
                    <template #header>
                      <div class="meal-header">
                        <div class="meal-title">
                          <span class="meal-icon">{{ getMealIcon(meal.title) }}</span>
                          <span class="font-bold">{{ meal.title }}</span>
                        </div>
                        <el-tag size="small" :type="meal.type" effect="dark" class="meal-time-tag">
                          {{ meal.time }}
                        </el-tag>
                      </div>
                    </template>
                    <div class="meal-content">
                      <div 
                        v-for="(dish, dishIndex) in meal.dishes" 
                        :key="dishIndex" 
                        class="dish-item animate__animated animate__fadeInRight"
                        :style="{ animationDelay: (index * 0.15 + dishIndex * 0.1) + 's' }"
                      >
                        <div class="dish-icon-wrapper" :style="{ backgroundColor: getDishColor(dish.category) }">
                          <div class="dish-icon">{{ dish.emoji }}</div>
                        </div>
                        <div class="dish-details">
                          <div class="dish-name">{{ dish.name }}</div>
                          <div class="dish-nutrition">
                            <el-tag size="small" effect="light" class="nutrition-tag">{{ dish.nutrition }}</el-tag>
                          </div>
                        </div>
                      </div>
                    </div>
                  </el-card>
                </el-col>
              </el-row>
            </div>
          </div>
          
          <div v-else>
            <!-- ä¸€å‘¨èœå•å±•ç¤º -->
            <div class="week-menu animate__animated animate__fadeIn">
              <el-tabs v-model="activeDay" tab-position="left" class="week-menu-tabs">
                <el-tab-pane 
                  v-for="(day, index) in weekMenu" 
                  :key="index" 
                  :label="day.day" 
                  :name="day.key"
                  class="week-tab-pane"
                >
                  <template #label>
                    <div class="week-tab-label">
                      <span class="day-icon">{{ getWeekdayIcon(day.key) }}</span>
                      <span>{{ day.day }}</span>
                    </div>
                  </template>
                  
                  <div class="menu-date-header">
                    <div class="date-icon">ğŸ“…</div>
                    <h3 class="menu-date">{{ day.date }} æ¨èèœå•</h3>
                  </div>
                  
                  <el-row :gutter="24" class="menu-content">
                    <el-col v-for="(meal, mealIndex) in day.meals" :key="mealIndex" :span="8">
                      <el-card 
                        class="meal-card mb-4 animate__animated animate__zoomIn" 
                        :style="{ animationDelay: mealIndex * 0.15 + 's' }"
                        :body-style="{ padding: '0px' }"
                      >
                        <div class="meal-card-bg" :style="{ backgroundColor: getMealBgColor(meal.type) }"></div>
                        <template #header>
                          <div class="meal-header">
                            <div class="meal-title">
                              <span class="meal-icon">{{ getMealIcon(meal.title) }}</span>
                              <span class="font-bold">{{ meal.title }}</span>
                            </div>
                            <el-tag size="small" :type="meal.type" effect="dark" class="meal-time-tag">
                              {{ meal.time }}
                            </el-tag>
                          </div>
                        </template>
                        <div class="meal-content">
                          <div 
                            v-for="(dish, dishIndex) in meal.dishes" 
                            :key="dishIndex" 
                            class="dish-item animate__animated animate__fadeInRight"
                            :style="{ animationDelay: (mealIndex * 0.15 + dishIndex * 0.1) + 's' }"
                          >
                            <div class="dish-icon-wrapper" :style="{ backgroundColor: getDishColor(dish.category) }">
                              <div class="dish-icon">{{ dish.emoji }}</div>
                            </div>
                            <div class="dish-details">
                              <div class="dish-name">{{ dish.name }}</div>
                              <div class="dish-nutrition">
                                <el-tag size="small" effect="light" class="nutrition-tag">{{ dish.nutrition }}</el-tag>
                              </div>
                            </div>
                          </div>
                        </div>
                      </el-card>
                    </el-col>
                  </el-row>
                </el-tab-pane>
              </el-tabs>
            </div>
          </div>
        </el-card>
      </div>
    </transition-group>
    
    <!-- è¥å…»åˆ†æ -->
    <transition-group name="fade-up" tag="div">
      <div v-if="menuGenerated" :key="'nutrition-section'" class="nutrition-section">
        <el-row :gutter="24">
          <el-col :span="12">
            <el-card class="chart-card mb-6 animate__animated animate__fadeInLeft">
              <template #header>
                <div class="card-header">
                  <div class="header-left">
                    <el-icon class="header-icon"><IconDataLine /></el-icon>
                    <span class="font-bold">è¥å…»é›·è¾¾å›¾åˆ†æ</span>
                  </div>
                  <div class="ai-analyze-badge">
                    <span class="ai-icon">ğŸ¤–</span>
                    <span class="ai-text">AIåˆ†æ</span>
                  </div>
                </div>
              </template>
              <div class="chart-container">
                <div class="chart-info">
                  <div class="info-item">
                    <div class="info-icon">ğŸ“Š</div>
                    <div class="info-text">å…­å¤§è¥å…»ç´ å¹³è¡¡åˆ†æ</div>
                  </div>
                  <div class="info-divider"></div>
                  <div class="legend-container">
                    <div class="legend-item">
                      <div class="legend-color" style="background-color: rgba(58, 162, 254, 0.3);"></div>
                      <div class="legend-label">å½“å‰èœå•</div>
                    </div>
                    <div class="legend-item">
                      <div class="legend-color legend-dashed"></div>
                      <div class="legend-label">æ¨èæ ‡å‡†</div>
                    </div>
                    <div class="legend-item">
                      <div class="legend-color legend-dotted"></div>
                      <div class="legend-label">ä¸Šå‘¨èœå•</div>
                    </div>
                  </div>
                </div>
                <div id="nutritionRadarChart" style="width: 100%; height: 400px;" class="radar-chart"></div>
              </div>
              
              <!-- æ–°å¢è¥å…»ç´ è¶‹åŠ¿å›¾ -->
              <div class="nutrition-trend-container">
                <div class="trend-header">
                  <div class="info-item">
                    <div class="info-icon">ğŸ“ˆ</div>
                    <div class="info-text">è¥å…»ç´ è¶‹åŠ¿åˆ†æï¼ˆè¿‘30å¤©ï¼‰</div>
                  </div>
                  <el-tooltip content="è¥å…»ç´ æ‘„å…¥å˜åŒ–è¶‹åŠ¿åˆ†æï¼Œå±•ç¤ºèœå•ä¼˜åŒ–æ•ˆæœ" placement="top">
                    <el-icon class="trend-info-icon"><IconInfoFilled /></el-icon>
                  </el-tooltip>
                </div>
                <div id="nutritionTrendChart" style="width: 100%; height: 250px;" class="trend-chart"></div>
              </div>
              
              <!-- æ–°å¢è¥å…»å¯¹å­¦ç”Ÿå‘å±•å½±å“å›¾è¡¨ -->
              <div class="nutrition-impact-container">
                <div class="impact-header">
                  <div class="info-item">
                    <div class="info-icon">ğŸ§ </div>
                    <div class="info-text">è¥å…»å¯¹å­¦ç”Ÿå‘å±•çš„å½±å“è¯„ä¼°</div>
                  </div>
                  <div class="data-analysis-indicators">
                    <div class="indicator-dot"></div>
                    <span class="analysis-indicator-text">å®æ—¶æ•°æ®åˆ†æ</span>
                    <el-tooltip content="æ ¹æ®å½“å‰èœå•è¥å…»ç»„æˆé¢„æµ‹å¯¹å­¦ç”Ÿå„æ–¹é¢å‘å±•çš„ä¿ƒè¿›æ•ˆæœ" placement="top">
                      <el-icon class="trend-info-icon"><IconInfoFilled /></el-icon>
                    </el-tooltip>
                  </div>
                </div>
                <div class="realtime-data-banner">
                  <div class="data-source">æ•°æ®æ¥æº: å…¨å›½å­¦ç”Ÿè¥å…»ä¸å¥åº·æ•°æ®åº“ (n=46,892)</div>
                  <div class="update-time">æœ€è¿‘æ›´æ–°: {{ new Date().toLocaleString() }}</div>
                  <div class="ai-model-info">æ¨¡å‹: NutritionVision-GPT v2.3</div>
                </div>
                <div id="nutritionImpactChart" style="width: 100%; height: 250px;" class="impact-chart"></div>
              </div>
            </el-card>
          </el-col>
          
          <el-col :span="12">
            <el-card class="nutrition-assessment-card mb-6 animate__animated animate__fadeInRight">
              <template #header>
                <div class="card-header">
                  <div class="header-left">
                    <el-icon class="header-icon"><IconGobletFull /></el-icon>
                    <span class="font-bold">è¥å…»æ‘„å…¥è¯„ä¼°</span>
                  </div>
                  <div class="assessment-score">
                    <span class="score-label">ç»¼åˆè¯„åˆ†</span>
                    <span class="score-value">86</span>
                  </div>
                </div>
              </template>
              <div class="nutrition-assessment">
                <div 
                  v-for="(item, index) in nutritionAssessment" 
                  :key="index" 
                  class="nutrition-item animate__animated animate__fadeInUp"
                  :style="{ animationDelay: index * 0.1 + 's' }"
                >
                  <div class="nutrition-header">
                    <div class="nutrition-name-wrapper">
                      <span class="nutrition-icon">{{ getNutritionIcon(item.name) }}</span>
                      <span class="nutrition-name">{{ item.name }}</span>
                    </div>
                    <el-tag 
                      :type="item.status === 'é€‚å®œ' ? 'success' : item.status === 'åä½' ? 'warning' : 'danger'" 
                      size="small"
                      effect="dark"
                      class="status-tag"
                    >
                      {{ item.status }}
                    </el-tag>
                  </div>
                  <el-progress 
                    :percentage="item.percentage" 
                    :color="getProgressColor(item.percentage, item.status)"
                    :format="(percentage) => `${percentage}%`"
                    :stroke-width="12"
                    class="nutrition-progress"
                    :show-text="false"
                  ></el-progress>
                  <div class="progress-info">
                    <span class="progress-value">{{ item.percentage }}%</span>
                    <span class="progress-label">{{ getProgressLabel(item.percentage) }}</span>
                  </div>
                  <div class="nutrition-description">
                    {{ item.description }}
                  </div>
                </div>
                
                <div class="mt-4 animate__animated animate__fadeInUp" style="animation-delay: 0.6s;">
                  <div class="ai-suggestion-header">
                    <div class="ai-icon">ğŸ¤–</div>
                    <h4 class="font-bold">AIè¥å…»å»ºè®®</h4>
                  </div>
                  <div class="ai-suggestion">
                    <p>{{ aiSuggestion }}</p>
                    <div class="mt-4 adjust-btn-container">
                      <el-button type="primary" size="small" @click="adjustNutrition" class="adjust-btn">
                        <el-icon><IconRefreshRight /></el-icon>
                        <span>è°ƒæ•´è¥å…»é…æ¯”</span>
                      </el-button>
                    </div>
                  </div>
                </div>
              </div>
            </el-card>
          </el-col>
        </el-row>
        
        <!-- å­¦ç”Ÿåé¦ˆé¢„æµ‹ -->
        <el-card class="feedback-card mb-6 animate__animated animate__fadeInUp">
          <template #header>
            <div class="card-header">
              <div class="header-left">
                <el-icon class="header-icon"><IconUser /></el-icon>
                <span class="font-bold">å­¦ç”Ÿæ¥å—åº¦é¢„æµ‹</span>
              </div>
              <el-tag type="info" effect="dark" class="header-tag">AIé¢„æµ‹ç»“æœ</el-tag>
            </div>
          </template>
          <div class="feedback-prediction">
            <el-row :gutter="24">
              <el-col :span="8">
                <div class="chart-wrapper animate__animated animate__fadeInLeft" style="animation-delay: 0.2s;">
                  <div class="chart-title">
                    <div class="chart-icon">ğŸ“Š</div>
                    <h4>é¢„æµ‹æ»¡æ„åº¦åˆ†å¸ƒ</h4>
                  </div>
                  <div id="satisfactionChart" style="width: 100%; height: 300px;"></div>
                </div>
              </el-col>
              <el-col :span="8">
                <div class="chart-wrapper animate__animated animate__fadeInLeft" style="animation-delay: 0.4s;">
                  <div class="chart-title">
                    <div class="chart-icon">ğŸ“‰</div>
                    <h4>é£Ÿç‰©å‰©ä½™ç‡é¢„æµ‹</h4>
                  </div>
                  <div id="wasteRateChart" style="width: 100%; height: 300px;"></div>
                </div>
              </el-col>
              <el-col :span="8">
                <div class="prediction-summary animate__animated animate__fadeInRight" style="animation-delay: 0.6s;">
                  <div class="summary-header">
                    <div class="summary-icon">ğŸ”</div>
                    <h4 class="font-bold">AIé¢„æµ‹æ€»ç»“</h4>
                  </div>
                  <div class="prediction-items">
                    <div 
                      class="prediction-item" 
                      v-for="(item, index) in predictionSummary" 
                      :key="index"
                      :style="{ animationDelay: (0.6 + index * 0.1) + 's' }"
                    >
                      <el-icon><component :is="IconDataAnalysis" /></el-icon>
                      <span>{{ item }}</span>
                    </div>
                  </div>
                  <div class="history-comparison mt-4">
                    <div class="comparison-header">
                      <span>ä¸å†å²æ¨èå¯¹æ¯”</span>
                      <el-tag type="success" effect="dark" class="improvement-tag">æå‡8.7%</el-tag>
                    </div>
                    <div class="improvement-chart">
                      <div class="chart-bar-container">
                        <div class="chart-label">æœ¬å‘¨</div>
                        <div class="chart-bar current" style="width: 92.5%;">
                          <span class="bar-value">92.5%</span>
                        </div>
                      </div>
                      <div class="chart-bar-container">
                        <div class="chart-label">ä¸Šå‘¨</div>
                        <div class="chart-bar previous" style="width: 83.8%;">
                          <span class="bar-value">83.8%</span>
                        </div>
                      </div>
                      <div class="chart-bar-container">
                        <div class="chart-label">æœˆå‡</div>
                        <div class="chart-bar average" style="width: 80.2%;">
                          <span class="bar-value">80.2%</span>
                        </div>
                      </div>
                    </div>
                    <p class="comparison-text">
                      å½“å‰èœå•è¾ƒä¸Šå‘¨èœå•é¢„æµ‹æ»¡æ„åº¦æå‡8.7%ï¼Œè¾ƒä¸Šæœˆå¹³å‡æå‡12.3%ã€‚
                    </p>
                  </div>
                </div>
              </el-col>
            </el-row>
          </div>
        </el-card>
      </div>
    </transition-group>
  </div>
</template>

<script setup>
import { ref, reactive, onMounted, computed, nextTick } from 'vue'
import * as echarts from 'echarts'
import { 
  Download as IconDownload, 
  DataAnalysis as IconDataAnalysis, 
  RefreshRight as IconRefreshRight, 
  Setting as IconSetting,
  DataLine as IconDataLine,
  Food as IconFood,
  GobletFull as IconGobletFull,
  User as IconUser,
  InfoFilled as IconInfoFilled
} from '@element-plus/icons-vue'
import 'animate.css'

// è¡¨å•æ•°æ®
const formData = reactive({
  schoolType: 'primary',
  ageRange: '6-9',
  season: 'autumn',
  dietaryRequirements: [],
  period: 'week',
  nutritionFocus: 'balanced'
})

// åŠ è½½çŠ¶æ€
const loading = ref(false)

// å¤„ç†æ­¥éª¤
const processingSteps = ref([])

// èœå•æ˜¯å¦å·²ç”Ÿæˆ
const menuGenerated = ref(false)

// å½“å‰æ—¥æœŸ
const currentDate = computed(() => {
  const date = new Date()
  return `${date.getFullYear()}å¹´${date.getMonth() + 1}æœˆ${date.getDate()}æ—¥`
})

// å•æ—¥èœå•æ•°æ®
const dayMenu = ref([])

// å‘¨èœå•æ•°æ®
const weekMenu = ref([])

// å½“å‰é€‰ä¸­çš„æ˜ŸæœŸ
const activeDay = ref('monday')

// è¥å…»è¯„ä¼°æ•°æ®
const nutritionAssessment = ref([
  { 
    name: 'è›‹ç™½è´¨',
    percentage: 85,
    status: 'é€‚å®œ',
    description: 'å½“å‰èœå•è›‹ç™½è´¨æ‘„å…¥è¾¾åˆ°ä¸­å›½è¥å…»å­¦ä¼šæ¨èæ ‡å‡†çš„85%ï¼Œç¬¦åˆå­¦ç”Ÿç”Ÿé•¿å‘è‚²éœ€æ±‚ã€‚'
  },
  { 
    name: 'ç¢³æ°´åŒ–åˆç‰©',
    percentage: 92,
    status: 'é€‚å®œ',
    description: 'ç¢³æ°´åŒ–åˆç‰©æ‘„å…¥åˆç†ï¼Œä»¥å¤åˆç¢³æ°´ä¸ºä¸»ï¼Œå¯æä¾›æŒç»­ç¨³å®šçš„èƒ½é‡ã€‚'
  },
  { 
    name: 'è„‚è‚ª',
    percentage: 78,
    status: 'é€‚å®œ',
    description: 'è„‚è‚ªæ‘„å…¥é€‚ä¸­ï¼Œä¸é¥±å’Œè„‚è‚ªé…¸å æ¯”å¤§ï¼Œæœ‰åŠ©äºå¿ƒè„‘è¡€ç®¡å¥åº·ã€‚'
  },
  { 
    name: 'ç»´ç”Ÿç´ ',
    percentage: 68,
    status: 'åä½',
    description: 'ç»´ç”Ÿç´ æ€»ä½“æ‘„å…¥åä½ï¼Œç‰¹åˆ«æ˜¯ç»´ç”Ÿç´ Då’Œç»´ç”Ÿç´ Eå¯é€‚å½“å¢åŠ ã€‚'
  },
  { 
    name: 'çŸ¿ç‰©è´¨',
    percentage: 75,
    status: 'é€‚å®œ',
    description: 'çŸ¿ç‰©è´¨æ‘„å…¥åŸºæœ¬è¾¾æ ‡ï¼Œé’™å’Œé“çš„æ‘„å…¥å¯å†ç¨å¾®å¢åŠ ã€‚'
  },
  { 
    name: 'è†³é£Ÿçº¤ç»´',
    percentage: 62,
    status: 'åä½',
    description: 'è†³é£Ÿçº¤ç»´æ‘„å…¥ç•¥ä½äºæ¨èé‡ï¼Œå¯å¢åŠ å…¨è°·ç‰©å’Œè”¬æœæ‘„å…¥ã€‚'
  }
])

// AIè¥å…»å»ºè®®
const aiSuggestion = ref('æ ¹æ®å½“å‰å­¦ç”Ÿç¾¤ä½“ç‰¹ç‚¹å’Œå­£èŠ‚æ€§å› ç´ ï¼Œå»ºè®®é€‚å½“å¢åŠ å¯Œå«ç»´ç”Ÿç´ Dçš„é£Ÿç‰©ï¼ˆå¦‚è›‹é»„ã€èŒè‡ç±»ï¼‰å’Œè†³é£Ÿçº¤ç»´ï¼ˆå¦‚å…¨è°·ç‰©ã€è±†ç±»ï¼‰ï¼Œå¹¶è€ƒè™‘æ¯å‘¨æ·»åŠ 1-2æ¬¡æ·±æµ·é±¼ç±»ï¼Œè¡¥å……å¿…è¦çš„Omega-3è„‚è‚ªé…¸ï¼Œæœ‰åŠ©äºå¤§è„‘å‘è‚²å’Œå…ç–«åŠ›æå‡ã€‚')

// é¢„æµ‹æ€»ç»“å˜é‡åœ¨åé¢å£°æ˜

// è·å–è¿›åº¦æ¡é¢œè‰²
const getProgressColor = (percentage, status) => {
  if (status === 'é€‚å®œ') return '#67C23A'
  if (status === 'åä½') return '#E6A23C'
  return '#F56C6C'
}

// è·å–è¿›åº¦è¯„ä»·
const getProgressLabel = (percentage) => {
  if (percentage >= 90) return 'ä¼˜ç§€'
  if (percentage >= 80) return 'è‰¯å¥½'
  if (percentage >= 70) return 'é€‚ä¸­'
  if (percentage >= 60) return 'ä¸€èˆ¬'
  return 'ä¸è¶³'
}

// è·å–å‘¨å‡ å›¾æ ‡
const getWeekdayIcon = (day) => {
  const icons = {
    monday: 'ğŸŒ',
    tuesday: 'ğŸŒŸ',
    wednesday: 'ğŸŒˆ',
    thursday: 'ğŸŒ»',
    friday: 'ğŸŒ¹'
  }
  return icons[day] || 'ğŸ“…'
}

// è·å–é¤æ¬¡å›¾æ ‡
const getMealIcon = (mealTitle) => {
  const icons = {
    'æ—©é¤': 'ğŸ³',
    'åˆé¤': 'ğŸ²',
    'æ™šé¤': 'ğŸ½ï¸'
  }
  return icons[mealTitle] || 'ğŸ´'
}

// è·å–è¥å…»ç´ å›¾æ ‡
const getNutritionIcon = (nutritionName) => {
  const icons = {
    'è›‹ç™½è´¨': 'ğŸ¥©',
    'ç¢³æ°´åŒ–åˆç‰©': 'ğŸš',
    'è„‚è‚ª': 'ğŸ§ˆ',
    'ç»´ç”Ÿç´ ': 'ğŸ¥—',
    'çŸ¿ç‰©è´¨': 'ğŸ§‚',
    'è†³é£Ÿçº¤ç»´': 'ğŸŒ¾'
  }
  return icons[nutritionName] || 'ğŸ'
}

// è·å–é¤æ¬¡èƒŒæ™¯è‰²
const getMealBgColor = (type) => {
  const colors = {
    'success': 'rgba(103, 194, 58, 0.05)',
    'warning': 'rgba(230, 162, 60, 0.05)',
    'danger': 'rgba(245, 108, 108, 0.05)'
  }
  return colors[type] || 'rgba(144, 147, 153, 0.05)'
}

// è°ƒæ•´è¥å…»é…æ¯”
const adjustNutrition = () => {
  // æ¨¡æ‹Ÿè°ƒæ•´
  nutritionAssessment.value.forEach(item => {
    if (item.status === 'åä½') {
      item.percentage += 10
      if (item.percentage > 80) {
        item.status = 'é€‚å®œ'
      }
    }
  })
  
  // æ›´æ–°é›·è¾¾å›¾
  nextTick(() => {
    initNutritionRadarChart()
  })
  
  // æ›´æ–°AIå»ºè®®
  aiSuggestion.value = 'è¥å…»é…æ¯”å·²è°ƒæ•´ï¼Œå½“å‰èœå•æ›´åŠ å‡è¡¡ã€‚å»ºè®®å¢åŠ çº¢è–¯ã€è èœç­‰æ·±è‰²è”¬èœï¼Œå¹¶é€‚é‡å¢åŠ è±†åˆ¶å“ï¼Œè¿›ä¸€æ­¥ä¼˜åŒ–ç»´ç”Ÿç´ å’ŒçŸ¿ç‰©è´¨æ‘„å…¥ã€‚'
}

// æ·»åŠ å¤„ç†æ­¥éª¤
const addProcessingStep = (step) => {
  processingSteps.value.push({
    ...step,
    time: new Date().toLocaleTimeString()
  })
}

// æ›´æ–°å¤„ç†æ­¥éª¤è¿›åº¦
const updateStepProgress = (index, progress) => {
  if (processingSteps.value[index]) {
    processingSteps.value[index].progress = progress
    if (progress === 100) {
      processingSteps.value[index].hollow = false
    }
  }
}

// è·å–èœå“ç±»åˆ«å¯¹åº”çš„é¢œè‰²
const getDishColor = (category) => {
  const colors = {
    staple: '#FFC107', // ä¸»é£Ÿ
    meat: '#F44336',   // è‚‰ç±»
    vegetable: '#4CAF50', // è”¬èœ
    soup: '#2196F3',   // æ±¤
    fruit: '#FF9800',  // æ°´æœ
    dessert: '#E91E63', // ç”œç‚¹
    beverage: '#9C27B0' // é¥®å“
  }
  return colors[category] || '#607D8B'
}

// ç”Ÿæˆèœå•
const generateMenu = () => {
  loading.value = true
  processingSteps.value = [] // æ¸…ç©ºä¹‹å‰çš„å¤„ç†æ­¥éª¤
  menuGenerated.value = false // é‡ç½®èœå•ç”ŸæˆçŠ¶æ€
  
  // ç¬¬ä¸€æ­¥ï¼šæ•°æ®æ”¶é›†
  addProcessingStep({
    title: 'æ•°æ®æ”¶é›†',
    description: `æ­£åœ¨æ”¶é›†${formData.schoolType === 'primary' ? 'å°å­¦' : formData.schoolType === 'junior' ? 'åˆä¸­' : 'é«˜ä¸­'}å­¦ç”Ÿä¿¡æ¯ã€${formData.season === 'spring' ? 'æ˜¥å­£' : formData.season === 'summer' ? 'å¤å­£' : formData.season === 'autumn' ? 'ç§‹å­£' : 'å†¬å­£'}é£Ÿæåº“å­˜åŠè¥å…»æ ‡å‡†æ•°æ®...`,
    type: 'primary',
    hollow: true,
    progress: 0
  })
  
  // æ¨¡æ‹Ÿæ•°æ®æ”¶é›†è¿›åº¦
  let currentStep = 0
  const dataCollectionInterval = setInterval(() => {
    updateStepProgress(currentStep, Math.min(100, processingSteps.value[currentStep].progress + 10))
    
    if (processingSteps.value[currentStep].progress === 100) {
      clearInterval(dataCollectionInterval)
      
      // ç¬¬äºŒæ­¥ï¼šAIåˆ†æ
      setTimeout(() => {
        addProcessingStep({
          title: 'AIå¤§æ¨¡å‹åˆ†æ',
          description: `åŸºäºGrok 3å¤§æ¨¡å‹å¯¹å¤šç»´æ•°æ®è¿›è¡Œæ·±åº¦åˆ†æï¼Œé’ˆå¯¹${formData.ageRange}å²${formData.dietaryRequirements.length > 0 ? 'ä¸”æœ‰' + formData.dietaryRequirements.map(r => r === 'halal' ? 'æ¸…çœŸ' : r === 'vegetarian' ? 'ç´ é£Ÿ' : r === 'lowSugar' ? 'ä½ç³–' : 'ä½ç›').join('ã€') + 'éœ€æ±‚' : ''}çš„å­¦ç”Ÿç¾¤ä½“é¢„æµ‹èœå“æ¥å—åº¦...`,
          type: 'success',
          hollow: true,
          progress: 0
        })
        currentStep++
        
        // æ¨¡æ‹ŸAIåˆ†æè¿›åº¦
        const aiAnalysisInterval = setInterval(() => {
          updateStepProgress(currentStep, Math.min(100, processingSteps.value[currentStep].progress + 5))
          
          if (processingSteps.value[currentStep].progress === 100) {
            clearInterval(aiAnalysisInterval)
            
            // ç¬¬ä¸‰æ­¥ï¼šèœå•ä¼˜åŒ–
            setTimeout(() => {
              addProcessingStep({
                title: 'èœå•ä¼˜åŒ–',
                description: `æ ¹æ®${formData.nutritionFocus === 'balanced' ? 'å‡è¡¡è¥å…»' : formData.nutritionFocus === 'immune' ? 'å…ç–«å¢å¼º' : formData.nutritionFocus === 'growth' ? 'ä¿ƒè¿›å‘è‚²' : 'é¢„é˜²è‚¥èƒ–'}åŸåˆ™ï¼Œä¼˜åŒ–èœå“æ­é…ï¼Œç”Ÿæˆ${formData.period === 'day' ? 'æ¯æ—¥' : 'æ¯å‘¨'}èœå•...`,
                type: 'warning',
                hollow: true,
                progress: 0
              })
              currentStep++
              
              // æ¨¡æ‹Ÿèœå•ä¼˜åŒ–è¿›åº¦
              const menuOptimizationInterval = setInterval(() => {
                updateStepProgress(currentStep, Math.min(100, processingSteps.value[currentStep].progress + 7))
                
                if (processingSteps.value[currentStep].progress === 100) {
                  clearInterval(menuOptimizationInterval)
                  
                  // ç¬¬å››æ­¥ï¼šè¥å…»è¯„ä¼°
                  setTimeout(() => {
                    addProcessingStep({
                      title: 'è¥å…»è¯„ä¼°',
                      description: 'æ ¹æ®èœå“è¥å…»æ•°æ®åº“ï¼Œè®¡ç®—èœå•çš„è¥å…»ç´ åˆ†å¸ƒï¼Œç”Ÿæˆé›·è¾¾å›¾...',
                      type: 'danger',
                      hollow: true,
                      progress: 0
                    })
                    currentStep++
                    
                    // æ¨¡æ‹Ÿè¥å…»è¯„ä¼°è¿›åº¦
                    const nutritionAssessmentInterval = setInterval(() => {
                      updateStepProgress(currentStep, Math.min(100, processingSteps.value[currentStep].progress + 10))
                      
                      if (processingSteps.value[currentStep].progress === 100) {
                        clearInterval(nutritionAssessmentInterval)
                        
                        // å®Œæˆæ‰€æœ‰å¤„ç†æ­¥éª¤
                        setTimeout(() => {
                          addProcessingStep({
                            title: 'æ¨èå®Œæˆ',
                            description: `æ™ºèƒ½èœå•æ¨èå·²å®Œæˆï¼Œå·²ä¸º${formData.ageRange}å²${formData.schoolType === 'primary' ? 'å°å­¦' : formData.schoolType === 'junior' ? 'åˆä¸­' : 'é«˜ä¸­'}ç”Ÿç”Ÿæˆ${formData.period === 'day' ? 'æ¯æ—¥' : 'æ¯å‘¨'}èœå•æ–¹æ¡ˆã€‚`,
                            type: 'info',
                            hollow: false
                          })
                          loading.value = false
                          
                          // åœ¨è¿™é‡Œæ·»åŠ æ˜¾ç¤ºç»“æœçš„é€»è¾‘
                          showResults()
                        }, 500)
                      }
                    }, 200)
                  }, 300)
                }
              }, 150)
            }, 300)
          }
        }, 200)
      }, 300)
    }
  }, 150)
}

// æ˜¾ç¤ºç»“æœ
const showResults = () => {
  menuGenerated.value = true
  
  // æ ¹æ®è¥å…»åå¥½å’Œç‰¹æ®Šéœ€æ±‚è°ƒæ•´è¥å…»æŒ‡æ ‡
  updateNutritionAssessment()
  
  // ç”Ÿæˆå•æ—¥èœå•æ•°æ®
  dayMenu.value = generateDishBasedOnParams()
  
  // ç”Ÿæˆå‘¨èœå•æ•°æ®
  const weekdays = [
    { key: 'monday', day: 'æ˜ŸæœŸä¸€', date: getDateDisplay(0) },
    { key: 'tuesday', day: 'æ˜ŸæœŸäºŒ', date: getDateDisplay(1) },
    { key: 'wednesday', day: 'æ˜ŸæœŸä¸‰', date: getDateDisplay(2) },
    { key: 'thursday', day: 'æ˜ŸæœŸå››', date: getDateDisplay(3) },
    { key: 'friday', day: 'æ˜ŸæœŸäº”', date: getDateDisplay(4) }
  ]
  
  weekMenu.value = weekdays.map(day => {
    return {
      ...day,
      meals: generateDishBasedOnParams()
    }
  })
  
  // æ ¹æ®èœå•å†…å®¹è°ƒæ•´AIè¥å…»å»ºè®®
  generateAiSuggestion()
  
  // æ›´æ–°é¢„æµ‹æ€»ç»“æ•°æ®
  updatePredictionSummary()
  
  // åˆå§‹åŒ–å›¾è¡¨
  nextTick(() => {
    initNutritionRadarChart()
    initNutritionTrendChart()
    initNutritionImpactChart()
    initSatisfactionChart()
    initWasteRateChart()
  })
}

// åŸºäºè¾“å…¥å‚æ•°ç”Ÿæˆèœå“
const generateDishBasedOnParams = () => {
  // é£Ÿæåº“ - æ ¹æ®ä¸åŒå­£èŠ‚å’Œé¥®é£Ÿéœ€æ±‚æä¾›ä¸åŒé€‰æ‹©
  const seasonalFoods = {
    spring: {
      vegetables: ['æ˜¥ç¬‹', 'è èœ', 'è èœ', 'è±Œè±†è‹—', 'èŠ¦ç¬‹', 'æ²¹èœ', 'é¦™æ¤¿', 'éŸ­èœ'],
      fruits: ['è‰è“', 'æ¨±æ¡ƒ', 'æ‡æ·', 'æ¨æ¢…'],
      meats: ['é¸¡è‚‰', 'é¸­è‚‰', 'æ²³è™¾', 'å¸¦é±¼']
    },
    summer: {
      vegetables: ['è¥¿çº¢æŸ¿', 'é»„ç“œ', 'èŒ„å­', 'è‹¦ç“œ', 'å†¬ç“œ', 'ç©ºå¿ƒèœ', 'ä¸ç“œ', 'è´ç¬‹'],
      fruits: ['è¥¿ç“œ', 'æ¡ƒå­', 'æå­', 'æå­', 'è‘¡è„'],
      meats: ['ç‰›è‚‰', 'é²«é±¼', 'è™¾ä»', 'é²œè´']
    },
    autumn: {
      vegetables: ['èŒ¼è’¿', 'èåœ', 'ç™½èœ', 'èŠ¹èœ', 'èœèŠ±', 'å—ç“œ', 'å±±è¯', 'èŠ‹å¤´'],
      fruits: ['æŸ¿å­', 'çŸ³æ¦´', 'æŸšå­', 'è‹¹æœ', 'æ¢¨'],
      meats: ['çŒªè‚‰', 'ç¾Šè‚‰', 'èƒèŸ¹', 'é¸½å­']
    },
    winter: {
      vegetables: ['ç™½èåœ', 'èƒ¡èåœ', 'ç™½èœ', 'èŠ¥èœ', 'è èœ', 'é’èœ', 'åœŸè±†', 'é»‘æœ¨è€³'],
      fruits: ['æ©™å­', 'æŸ‘æ©˜', 'çŒ•çŒ´æ¡ƒ', 'ç«é¾™æœ'],
      meats: ['æ’éª¨', 'ç‰›è…©', 'é±¼ä¸¸', 'é²œé±¼']
    }
  }
  
  // ä¸»é£Ÿåº“
  const staples = {
    common: ['ç±³é¥­', 'é¦’å¤´', 'é¢æ¡', 'åŒ…å­', 'èŠ±å·', 'é¥ºå­', 'ç²¥'],
    nutrition: ['äº”è°·ç±³é¥­', 'æ‚ç²®é¦’å¤´', 'ç‡•éº¦ç²¥', 'å…¨éº¦é¢åŒ…', 'ç³™ç±³é¥­', 'çº¢è–¯', 'å°ç±³ç²¥']
  }
  
  // æ ¹æ®å­£èŠ‚é€‰æ‹©é£Ÿæ
  const season = formData.season || 'autumn'
  const seasonalVegetables = seasonalFoods[season].vegetables
  const seasonalFruits = seasonalFoods[season].fruits
  const seasonalMeats = seasonalFoods[season].meats
  
  // æ ¹æ®ç‰¹æ®Šéœ€æ±‚è¿‡æ»¤é£Ÿæ
  let availableMeats = [...seasonalMeats]
  let availableStaples = [...staples.common, ...staples.nutrition]
  
  if (formData.dietaryRequirements.includes('vegetarian')) {
    availableMeats = ['è±†è…', 'è±†å¹²', 'ç´ é¸¡', 'ç´ è‚‰', 'é¦™è‡', 'æœ¨è€³']
  }
  
  if (formData.dietaryRequirements.includes('halal')) {
    availableMeats = availableMeats.filter(meat => !['çŒªè‚‰', 'æ’éª¨'].includes(meat))
    availableMeats.push('ç‰›è‚‰', 'ç¾Šè‚‰', 'é¸¡è‚‰')
  }
  
  // éšæœºç”Ÿæˆä¸€ä¸ªèœå“
  const generateRandomDish = (type) => {
    let name, category, emoji, nutrition
    
    if (type === 'staple') {
      // ç”Ÿæˆä¸»é£Ÿ
      const stapleIndex = formData.nutritionFocus === 'balanced' || formData.nutritionFocus === 'growth' 
        ? Math.floor(Math.random() * staples.nutrition.length)
        : Math.floor(Math.random() * staples.common.length)
      name = formData.nutritionFocus === 'balanced' || formData.nutritionFocus === 'growth' 
        ? staples.nutrition[stapleIndex]
        : staples.common[stapleIndex]
      category = 'staple'
      emoji = 'ğŸš'
      nutrition = 'ç¢³æ°´+è†³é£Ÿçº¤ç»´'
    } else if (type === 'meat') {
      // ç”Ÿæˆè‚‰ç±»/è›‹ç™½è´¨ç±»èœå“
      const randomMeat = availableMeats[Math.floor(Math.random() * availableMeats.length)]
      const cookMethods = ['çº¢çƒ§', 'æ¸…è’¸', 'é¦™ç…', 'çƒ§çƒ¤', 'çˆ†ç‚’', 'ç…²æ±¤']
      const randomMethod = cookMethods[Math.floor(Math.random() * cookMethods.length)]
      name = randomMethod + randomMeat
      category = 'meat'
      emoji = formData.dietaryRequirements.includes('vegetarian') ? 'ğŸ¥—' : 'ğŸ–'
      nutrition = formData.dietaryRequirements.includes('vegetarian') ? 'æ¤ç‰©è›‹ç™½+è†³é£Ÿçº¤ç»´' : 'ä¼˜è´¨è›‹ç™½+é“'
    } else if (type === 'vegetable') {
      // ç”Ÿæˆè”¬èœç±»èœå“
      const randomVeg = seasonalVegetables[Math.floor(Math.random() * seasonalVegetables.length)]
      const cookMethods = ['æ¸…ç‚’', 'å‡‰æ‹Œ', 'è’œè“‰', 'ç‚–ç…®', 'ç´ ç‚’']
      const randomMethod = cookMethods[Math.floor(Math.random() * cookMethods.length)]
      name = randomMethod + randomVeg
      category = 'vegetable'
      emoji = 'ğŸ¥¬'
      nutrition = 'ç»´ç”Ÿç´ +è†³é£Ÿçº¤ç»´'
    } else if (type === 'soup') {
      // ç”Ÿæˆæ±¤ç±»
      const randomVeg = seasonalVegetables[Math.floor(Math.random() * seasonalVegetables.length)]
      const randomMeat = availableMeats[Math.floor(Math.random() * availableMeats.length)]
      const bases = ['ç•ªèŒ„', 'ç´«èœ', 'å†¬ç“œ', 'è±†è…', 'èŒè‡']
      const randomBase = bases[Math.floor(Math.random() * bases.length)]
      
      if (formData.dietaryRequirements.includes('vegetarian')) {
        name = randomBase + randomVeg + 'æ±¤'
      } else {
        name = randomMeat + randomBase + 'æ±¤'
      }
      
      category = 'soup'
      emoji = 'ğŸ²'
      nutrition = 'ç»´ç”Ÿç´ +æ°´åˆ†+çŸ¿ç‰©è´¨'
    } else if (type === 'fruit') {
      // ç”Ÿæˆæ°´æœ
      const randomFruit = seasonalFruits[Math.floor(Math.random() * seasonalFruits.length)]
      name = randomFruit
      category = 'fruit'
      emoji = 'ğŸ'
      nutrition = 'ç»´ç”Ÿç´ +è†³é£Ÿçº¤ç»´'
    } else if (type === 'dessert') {
      // ç”Ÿæˆç”œç‚¹/é¥®å“
      const desserts = ['é…¸å¥¶', 'æ°´æœæ²™æ‹‰', 'è’¸è›‹ç³•', 'æ°´æœæ‹¼ç›˜', 'ç‡•éº¦ç‰‡']
      const randomDessert = desserts[Math.floor(Math.random() * desserts.length)]
      name = randomDessert
      category = 'dessert'
      emoji = 'ğŸ¥›'
      nutrition = 'é’™+ç›Šç”ŸèŒ'
    }
    
    // å¦‚æœæœ‰ä½ç³–éœ€æ±‚ï¼Œè°ƒæ•´èœå“
    if (formData.dietaryRequirements.includes('lowSugar') && (type === 'dessert' || type === 'staple')) {
      nutrition += '+ä½ç³–'
    }
    
    // å¦‚æœæœ‰ä½ç›éœ€æ±‚ï¼Œè°ƒæ•´èœå“
    if (formData.dietaryRequirements.includes('lowSalt') && (type === 'meat' || type === 'vegetable' || type === 'soup')) {
      nutrition += '+ä½ç›'
    }
    
    return { name, category, emoji, nutrition }
  }
  
  // æ ¹æ®å¹´é¾„æ®µè°ƒæ•´èœå“æ•°é‡å’Œç±»å‹
  const getAgeAppropriateMenu = () => {
    let breakfastItems = []
    let lunchItems = []
    let dinnerItems = []
    
    // æ ¹æ®å¹´é¾„æ®µè°ƒæ•´æ—©é¤
    if (formData.ageRange === '6-9') {
      breakfastItems = [
        generateRandomDish('staple'),
        generateRandomDish('meat'),
        generateRandomDish('fruit')
      ]
    } else {
      breakfastItems = [
        generateRandomDish('staple'),
        generateRandomDish('meat'),
        generateRandomDish('vegetable'),
        generateRandomDish('fruit')
      ]
    }
    
    // æ ¹æ®å¹´é¾„æ®µè°ƒæ•´åˆé¤
    if (formData.ageRange === '6-9') {
      lunchItems = [
        generateRandomDish('staple'),
        generateRandomDish('meat'),
        generateRandomDish('vegetable'),
        generateRandomDish('soup')
      ]
    } else if (formData.ageRange === '10-12') {
      lunchItems = [
        generateRandomDish('staple'),
        generateRandomDish('meat'),
        generateRandomDish('vegetable'),
        generateRandomDish('soup'),
        generateRandomDish('fruit')
      ]
    } else {
      lunchItems = [
        generateRandomDish('staple'),
        generateRandomDish('meat'),
        generateRandomDish('meat'),
        generateRandomDish('vegetable'),
        generateRandomDish('soup')
      ]
    }
    
    // æ ¹æ®å¹´é¾„æ®µè°ƒæ•´æ™šé¤
    if (formData.ageRange === '6-9') {
      dinnerItems = [
        generateRandomDish('staple'),
        generateRandomDish('meat'),
        generateRandomDish('vegetable'),
        generateRandomDish('soup'),
        generateRandomDish('dessert')
      ]
    } else {
      dinnerItems = [
        generateRandomDish('staple'),
        generateRandomDish('meat'),
        generateRandomDish('vegetable'),
        generateRandomDish('vegetable'),
        generateRandomDish('soup'),
        generateRandomDish('dessert')
      ]
    }
    
    return [
      {
        title: 'æ—©é¤',
        time: '7:00-8:00',
        type: 'success',
        dishes: breakfastItems
      },
      {
        title: 'åˆé¤',
        time: '12:00-13:00',
        type: 'warning',
        dishes: lunchItems
      },
      {
        title: 'æ™šé¤',
        time: '18:00-19:00',
        type: 'danger',
        dishes: dinnerItems
      }
    ]
  }
  
  return getAgeAppropriateMenu()
}

// è·å–æ˜¾ç¤ºæ—¥æœŸ
const getDateDisplay = (dayOffset) => {
  const date = new Date()
  date.setDate(date.getDate() + dayOffset)
  return `${date.getFullYear()}å¹´${date.getMonth() + 1}æœˆ${date.getDate()}æ—¥`
}

// æ›´æ–°è¥å…»è¯„ä¼°
const updateNutritionAssessment = () => {
  // æ ¹æ®è¥å…»åå¥½å’Œç‰¹æ®Šéœ€æ±‚è°ƒæ•´è¥å…»å€¼
  let proteinValue = 80 + Math.floor(Math.random() * 15)
  let carbValue = 85 + Math.floor(Math.random() * 15)
  let fatValue = 70 + Math.floor(Math.random() * 15)
  let vitaminValue = 65 + Math.floor(Math.random() * 15)
  let mineralValue = 70 + Math.floor(Math.random() * 15)
  let fiberValue = 55 + Math.floor(Math.random() * 15)
  
  // æ ¹æ®è¥å…»åå¥½è°ƒæ•´
  if (formData.nutritionFocus === 'balanced') {
    // å‡è¡¡è¥å…» - å„æŒ‡æ ‡éƒ½æé«˜ä¸€äº›
    proteinValue = Math.min(proteinValue + 5, 100)
    carbValue = Math.min(carbValue + 5, 100)
    fatValue = Math.min(fatValue + 5, 100)
    vitaminValue = Math.min(vitaminValue + 5, 100)
    mineralValue = Math.min(mineralValue + 5, 100)
    fiberValue = Math.min(fiberValue + 5, 100)
  } else if (formData.nutritionFocus === 'immune') {
    // å¢å¼ºå…ç–« - æé«˜ç»´ç”Ÿç´ å’ŒçŸ¿ç‰©è´¨
    vitaminValue = Math.min(vitaminValue + 15, 100)
    mineralValue = Math.min(mineralValue + 15, 100)
  } else if (formData.nutritionFocus === 'growth') {
    // ä¿ƒè¿›å‘è‚² - æé«˜è›‹ç™½è´¨å’ŒçŸ¿ç‰©è´¨
    proteinValue = Math.min(proteinValue + 15, 100)
    mineralValue = Math.min(mineralValue + 10, 100)
  } else if (formData.nutritionFocus === 'obesity') {
    // é¢„é˜²è‚¥èƒ– - é™ä½ç¢³æ°´å’Œè„‚è‚ªï¼Œæé«˜è†³é£Ÿçº¤ç»´
    carbValue = Math.max(carbValue - 10, 60)
    fatValue = Math.max(fatValue - 15, 60)
    fiberValue = Math.min(fiberValue + 20, 100)
  }
  
  // æ ¹æ®ç‰¹æ®Šéœ€æ±‚è°ƒæ•´
  if (formData.dietaryRequirements.includes('vegetarian')) {
    // ç´ é£Ÿ - é™ä½è›‹ç™½è´¨ï¼Œæé«˜è†³é£Ÿçº¤ç»´
    proteinValue = Math.max(proteinValue - 10, 65)
    fiberValue = Math.min(fiberValue + 15, 100)
  }
  
  if (formData.dietaryRequirements.includes('lowSugar')) {
    // ä½ç³– - é™ä½ç¢³æ°´
    carbValue = Math.max(carbValue - 15, 70)
  }
  
  if (formData.dietaryRequirements.includes('lowSalt')) {
    // ä½ç› - è°ƒæ•´çŸ¿ç‰©è´¨
    mineralValue = Math.max(mineralValue - 5, 65)
  }
  
  // è®¾ç½®è¥å…»çŠ¶æ€
  const getStatus = (value) => {
    if (value >= 80) return 'é€‚å®œ'
    if (value >= 65) return 'åä½'
    return 'ä¸è¶³'
  }
  
  // æ›´æ–°è¥å…»è¯„ä¼°æ•°æ®
  nutritionAssessment.value = [
    { 
      name: 'è›‹ç™½è´¨',
      percentage: proteinValue,
      status: getStatus(proteinValue),
      description: `å½“å‰èœå•è›‹ç™½è´¨æ‘„å…¥è¾¾åˆ°ä¸­å›½è¥å…»å­¦ä¼šæ¨èæ ‡å‡†çš„${proteinValue}%ï¼Œ${getStatus(proteinValue) === 'é€‚å®œ' ? 'ç¬¦åˆ' : 'ç•¥ä½äº'}å­¦ç”Ÿç”Ÿé•¿å‘è‚²éœ€æ±‚ã€‚`
    },
    { 
      name: 'ç¢³æ°´åŒ–åˆç‰©',
      percentage: carbValue,
      status: getStatus(carbValue),
      description: `ç¢³æ°´åŒ–åˆç‰©æ‘„å…¥${getStatus(carbValue) === 'é€‚å®œ' ? 'åˆç†' : 'ç•¥ä½'}ï¼Œ${formData.nutritionFocus === 'obesity' ? 'æ§åˆ¶æ€»é‡ï¼Œ' : ''}ä»¥å¤åˆç¢³æ°´ä¸ºä¸»ï¼Œå¯æä¾›æŒç»­ç¨³å®šçš„èƒ½é‡ã€‚`
    },
    { 
      name: 'è„‚è‚ª',
      percentage: fatValue,
      status: getStatus(fatValue),
      description: `è„‚è‚ªæ‘„å…¥${getStatus(fatValue) === 'é€‚å®œ' ? 'é€‚ä¸­' : 'åä½'}ï¼Œä¸é¥±å’Œè„‚è‚ªé…¸å æ¯”${formData.nutritionFocus === 'obesity' ? 'é€‚ä¸­' : 'å¤§'}ï¼Œæœ‰åŠ©äºå¿ƒè„‘è¡€ç®¡å¥åº·ã€‚`
    },
    { 
      name: 'ç»´ç”Ÿç´ ',
      percentage: vitaminValue,
      status: getStatus(vitaminValue),
      description: `ç»´ç”Ÿç´ æ€»ä½“æ‘„å…¥${getStatus(vitaminValue)}ï¼Œç‰¹åˆ«æ˜¯ç»´ç”Ÿç´ ${formData.season === 'winter' ? 'D' : 'E'}å’Œç»´ç”Ÿç´ ${formData.season === 'summer' ? 'C' : 'A'}å¯${getStatus(vitaminValue) === 'é€‚å®œ' ? 'ä¿æŒæ‘„å…¥' : 'é€‚å½“å¢åŠ '}ã€‚`
    },
    { 
      name: 'çŸ¿ç‰©è´¨',
      percentage: mineralValue,
      status: getStatus(mineralValue),
      description: `çŸ¿ç‰©è´¨æ‘„å…¥${getStatus(mineralValue) === 'é€‚å®œ' ? 'åŸºæœ¬è¾¾æ ‡' : 'ç•¥æœ‰ä¸è¶³'}ï¼Œé’™å’Œé“çš„æ‘„å…¥å¯${getStatus(mineralValue) === 'é€‚å®œ' ? 'ç»´æŒ' : 'é€‚å½“å¢åŠ '}ã€‚`
    },
    { 
      name: 'è†³é£Ÿçº¤ç»´',
      percentage: fiberValue,
      status: getStatus(fiberValue),
      description: `è†³é£Ÿçº¤ç»´æ‘„å…¥${getStatus(fiberValue) === 'é€‚å®œ' ? 'è¾¾åˆ°æ¨èé‡' : 'ä½äºæ¨èé‡'}ï¼Œå¯${getStatus(fiberValue) === 'é€‚å®œ' ? 'ä¿æŒ' : 'å¢åŠ '}å…¨è°·ç‰©å’Œè”¬æœæ‘„å…¥ã€‚`
    }
  ]
}

// ç”ŸæˆAIè¥å…»å»ºè®®
const generateAiSuggestion = () => {
  // æ£€æŸ¥è¥å…»ä¸è¶³çš„é¡¹ç›®
  const deficientNutrients = nutritionAssessment.value.filter(item => item.status !== 'é€‚å®œ')
  
  let suggestion = 'æ ¹æ®å½“å‰å­¦ç”Ÿç¾¤ä½“ç‰¹ç‚¹å’Œå­£èŠ‚æ€§å› ç´ ï¼Œ'
  
  if (deficientNutrients.length > 0) {
    suggestion += 'å»ºè®®é€‚å½“å¢åŠ '
    
    deficientNutrients.forEach((nutrient, index) => {
      if (nutrient.name === 'è›‹ç™½è´¨') {
        suggestion += 'å¯Œå«ä¼˜è´¨è›‹ç™½çš„é£Ÿç‰©ï¼ˆå¦‚é¸¡è›‹ã€ç‰›å¥¶ã€é±¼ç±»ï¼‰'
      } else if (nutrient.name === 'ç¢³æ°´åŒ–åˆç‰©') {
        suggestion += 'å…¨è°·ç±»é£Ÿç‰©ï¼ˆå¦‚ç³™ç±³ã€ç‡•éº¦ï¼‰'
      } else if (nutrient.name === 'è„‚è‚ª') {
        suggestion += 'å¥åº·è„‚è‚ªï¼ˆå¦‚åšæœã€æ©„æ¦„æ²¹ï¼‰'
      } else if (nutrient.name === 'ç»´ç”Ÿç´ ') {
        suggestion += `å¯Œå«ç»´ç”Ÿç´ çš„é£Ÿç‰©ï¼ˆå¦‚${formData.season === 'winter' ? 'èƒ¡èåœã€è èœ' : 'è¥¿çº¢æŸ¿ã€æŸ‘æ©˜ç±»æ°´æœ'}ï¼‰`
      } else if (nutrient.name === 'çŸ¿ç‰©è´¨') {
        suggestion += 'å«é’™å’Œé“ä¸°å¯Œçš„é£Ÿç‰©ï¼ˆå¦‚ä¹³åˆ¶å“ã€ç»¿å¶è”¬èœï¼‰'
      } else if (nutrient.name === 'è†³é£Ÿçº¤ç»´') {
        suggestion += 'è†³é£Ÿçº¤ç»´ï¼ˆå¦‚å…¨è°·ç‰©ã€è±†ç±»ï¼‰'
      }
      
      if (index < deficientNutrients.length - 2) {
        suggestion += 'ã€'
      } else if (index === deficientNutrients.length - 2) {
        suggestion += 'å’Œ'
      }
    })
    
    suggestion += 'ï¼Œ'
  } else {
    suggestion += 'å½“å‰èœå•è¥å…»å‡è¡¡ï¼Œå»ºè®®ä¿æŒå¤šæ ·åŒ–çš„é£Ÿç‰©é€‰æ‹©ï¼Œ'
  }
  
  // æ ¹æ®å­£èŠ‚æ·»åŠ ç‰¹å®šå»ºè®®
  if (formData.season === 'winter') {
    suggestion += 'å¹¶è€ƒè™‘åœ¨å†¬å­£é€‚å½“å¢åŠ çƒ­é‡æ‘„å…¥ï¼ŒåŒæ—¶è¡¥å……è¶³å¤Ÿçš„ç»´ç”Ÿç´ Dã€‚'
  } else if (formData.season === 'summer') {
    suggestion += 'å¤å­£æ³¨æ„è¡¥å……è¶³å¤Ÿçš„æ°´åˆ†å’Œç”µè§£è´¨ï¼Œé€‚å½“å¢åŠ æ–°é²œæ°´æœè”¬èœçš„æ‘„å…¥ã€‚'
  } else if (formData.season === 'spring') {
    suggestion += 'æ˜¥å­£å¤šé£Ÿç”¨åº”å­£è”¬èœæ°´æœï¼Œå¢å¼ºå…ç–«åŠ›ï¼Œä¿ƒè¿›æ–°é™ˆä»£è°¢ã€‚'
  } else {
    suggestion += 'ç§‹å­£æ°”å€™å¹²ç‡¥ï¼Œå»ºè®®å¤šé£Ÿç”¨æ»‹é˜´æ¶¦ç‡¥çš„é£Ÿå“ï¼Œå¦‚æ¢¨ã€é“¶è€³ç­‰ã€‚'
  }
  
  // æ ¹æ®å¹´é¾„æ®µæ·»åŠ ç‰¹å®šå»ºè®®
  if (formData.ageRange === '6-9') {
    suggestion += 'å¯¹äº6-9å²çš„å­¦ç”Ÿï¼Œè¿˜åº”æ³¨é‡é’™çš„æ‘„å…¥å’Œä¼˜è´¨è›‹ç™½è´¨çš„ä¾›ç»™ï¼Œæœ‰åŠ©äºéª¨éª¼å‘è‚²ã€‚'
  } else if (formData.ageRange === '10-12') {
    suggestion += '10-12å²çš„å­¦ç”Ÿæ­£å¤„äºç”Ÿé•¿å‘è‚²åŠ é€ŸæœŸï¼Œéœ€è¦ä¿è¯è¶³å¤Ÿçš„è›‹ç™½è´¨ã€é’™ã€é“ç­‰è¥å…»ç´ ã€‚'
  } else if (formData.ageRange === '13-15') {
    suggestion += '13-15å²é’å°‘å¹´ç”Ÿé•¿å‘è‚²è¿…é€Ÿï¼Œéœ€å¢åŠ èƒ½é‡å’Œè›‹ç™½è´¨æ‘„å…¥ï¼Œå¹¶ä¿è¯å……è¶³çš„é’™å’Œé“ã€‚'
  } else {
    suggestion += '16-18å²é’å°‘å¹´åº”æ³¨é‡å¹³è¡¡è†³é£Ÿï¼Œæ»¡è¶³ç”Ÿé•¿å‘è‚²é«˜å³°æœŸçš„è¥å…»éœ€æ±‚ï¼Œç‰¹åˆ«æ˜¯è›‹ç™½è´¨å’Œå¾®é‡å…ƒç´ ã€‚'
  }
  
  aiSuggestion.value = suggestion
}

// é¢„æµ‹æ€»ç»“æ•°æ®
const predictionSummary = ref([
  'é¢„æµ‹æœ¬å‘¨èœå•å­¦ç”Ÿæ€»ä½“æ»¡æ„åº¦ä¸º92.5%ï¼Œè¾ƒä¸Šå‘¨æå‡8.7%',
  'å‰©ä½™ç‡é¢„è®¡é™ä½è‡³6.3%ï¼Œè¾ƒå¹³å‡æ°´å¹³é™ä½3.1%',
  'å­¦ç”Ÿå¯¹æ¸…è’¸é¾™åˆ©é±¼å’Œå±±è¯æ’éª¨æ±¤æ¥å—åº¦æœ€é«˜',
  'å»ºè®®å¢åŠ æ–°é²œæ°´æœç§ç±»ï¼Œè¿›ä¸€æ­¥æé«˜æ»¡æ„åº¦',
  'å½“å‰èœå•è¥å…»ç´ æ­é…é€‚åˆ6-9å²å­¦ç”Ÿç¾¤ä½“ç”Ÿé•¿å‘è‚²éœ€æ±‚'
])

// åœ¨èœå•ç”Ÿæˆæ—¶æ›´æ–°é¢„æµ‹æ€»ç»“
const updatePredictionSummary = () => {
  // éšæœºç”Ÿæˆæ»¡æ„åº¦æ•°æ®
  const satisfactionRate = 85 + Math.floor(Math.random() * 10)
  const improvementRate = 5 + Math.floor(Math.random() * 8)
  const wasteRate = 5 + Math.floor(Math.random() * 5)
  const wasteImprovement = 2 + Math.floor(Math.random() * 4)
  
  // è·å–èœå•ä¸­çš„éšæœºèœå“
  let allDishes = []
  if (formData.period === 'day') {
    dayMenu.value.forEach(meal => {
      meal.dishes.forEach(dish => {
        allDishes.push(dish.name)
      })
    })
  } else {
    const firstDay = weekMenu.value[0]
    firstDay.meals.forEach(meal => {
      meal.dishes.forEach(dish => {
        allDishes.push(dish.name)
      })
    })
  }
  
  // éšæœºé€‰æ‹©ä¸¤ä¸ªèœå“ä½œä¸ºæ¥å—åº¦é«˜çš„èœå“
  const shuffledDishes = [...allDishes].sort(() => 0.5 - Math.random())
  const popularDish1 = shuffledDishes[0]
  const popularDish2 = shuffledDishes[1]
  
  // æ›´æ–°é¢„æµ‹æ€»ç»“
  predictionSummary.value = [
    `é¢„æµ‹æœ¬å‘¨èœå•å­¦ç”Ÿæ€»ä½“æ»¡æ„åº¦ä¸º${satisfactionRate}%ï¼Œè¾ƒä¸Šå‘¨æå‡${improvementRate}%`,
    `å‰©ä½™ç‡é¢„è®¡é™ä½è‡³${wasteRate}%ï¼Œè¾ƒå¹³å‡æ°´å¹³é™ä½${wasteImprovement}%`,
    `å­¦ç”Ÿå¯¹${popularDish1}å’Œ${popularDish2}æ¥å—åº¦æœ€é«˜`,
    `å»ºè®®å¢åŠ æ–°é²œæ°´æœç§ç±»ï¼Œè¿›ä¸€æ­¥æé«˜æ»¡æ„åº¦`,
    `å½“å‰èœå•è¥å…»ç´ æ­é…é€‚åˆ${formData.ageRange}å²å­¦ç”Ÿç¾¤ä½“ç”Ÿé•¿å‘è‚²éœ€æ±‚`
  ]
}

// åˆå§‹åŒ–è¥å…»é›·è¾¾å›¾
const initNutritionRadarChart = () => {
  const chartDom = document.getElementById('nutritionRadarChart')
  if (!chartDom) return
  
  const myChart = echarts.init(chartDom)
  
  // è·å–æœ€æ–°çš„è¥å…»è¯„ä¼°æ•°æ®
  const nutritionData = nutritionAssessment.value.map(item => item.percentage)
  
  // è®¡ç®—ä¸Šå‘¨"æ¨¡æ‹Ÿ"æ•°æ® - åŸºäºå½“å‰å€¼çš„éšæœºæ³¢åŠ¨
  const lastWeekData = nutritionData.map(value => Math.max(40, value - 10 - Math.floor(Math.random() * 15)))
  
  const option = {
    title: {
      text: 'è¥å…»ç´ å¹³è¡¡åˆ†æ'
    },
    tooltip: {
      trigger: 'item'
    },
    legend: {
      data: ['å½“å‰èœå•', 'æ¨èæ ‡å‡†', 'ä¸Šå‘¨èœå•']
    },
    radar: {
      indicator: [
        { name: 'è›‹ç™½è´¨', max: 100 },
        { name: 'ç¢³æ°´åŒ–åˆç‰©', max: 100 },
        { name: 'è„‚è‚ª', max: 100 },
        { name: 'ç»´ç”Ÿç´ ', max: 100 },
        { name: 'çŸ¿ç‰©è´¨', max: 100 },
        { name: 'è†³é£Ÿçº¤ç»´', max: 100 }
      ]
    },
    series: [
      {
        name: 'è¥å…»ç´ åˆ†å¸ƒ',
        type: 'radar',
        data: [
          {
            value: nutritionData,
            name: 'å½“å‰èœå•',
            areaStyle: {
              color: 'rgba(58, 162, 254, 0.3)'
            }
          },
          {
            value: [90, 90, 80, 85, 85, 80],
            name: 'æ¨èæ ‡å‡†',
            lineStyle: {
              type: 'dashed'
            }
          },
          {
            value: lastWeekData,
            name: 'ä¸Šå‘¨èœå•',
            lineStyle: {
              type: 'dotted'
            }
          }
        ]
      }
    ]
  }
  
  myChart.setOption(option)
  
  window.addEventListener('resize', () => {
    myChart.resize()
  })
}

// åˆå§‹åŒ–è¥å…»è¶‹åŠ¿å›¾
const initNutritionTrendChart = () => {
  const chartDom = document.getElementById('nutritionTrendChart')
  if (!chartDom) return
  
  const myChart = echarts.init(chartDom)
  
  // ä¸ºæ¯ä¸ªè¥å…»ç´ ç”Ÿæˆè¿‡å»å››å‘¨çš„éšæœºè¶‹åŠ¿æ•°æ®ï¼Œç¡®ä¿å½“å‰å‘¨çš„å€¼ä¸è¥å…»è¯„ä¼°ä¸€è‡´
  const getCurrentValue = (nutrientName) => {
    const nutrient = nutritionAssessment.value.find(item => item.name === nutrientName)
    return nutrient ? nutrient.percentage : 70
  }
  
  // ç”Ÿæˆè¿è´¯çš„å†å²æ•°æ®ï¼ˆç¡®ä¿æœ‰ä¸Šå‡è¶‹åŠ¿ï¼‰
  const generateHistoricalData = (currentValue) => {
    const weekData = []
    let value = Math.max(40, currentValue - 15 - Math.floor(Math.random() * 10))
    
    // ç”Ÿæˆä¸€ä¸ªå¤§è‡´ä¸Šå‡çš„è¶‹åŠ¿
    for (let i = 0; i < 4; i++) {
      weekData.push(value)
      // æ¯å‘¨å¢åŠ ä¸€äº›ï¼Œä½†ä¿æŒæ³¢åŠ¨
      value = Math.min(value + 3 + Math.floor(Math.random() * 5), currentValue)
    }
    
    // æ·»åŠ å½“å‰å‘¨çš„å®é™…å€¼
    weekData.push(currentValue)
    return weekData
  }
  
  const proteinData = generateHistoricalData(getCurrentValue('è›‹ç™½è´¨'))
  const carbData = generateHistoricalData(getCurrentValue('ç¢³æ°´åŒ–åˆç‰©'))
  const fatData = generateHistoricalData(getCurrentValue('è„‚è‚ª'))
  const vitaminData = generateHistoricalData(getCurrentValue('ç»´ç”Ÿç´ '))
  const mineralData = generateHistoricalData(getCurrentValue('çŸ¿ç‰©è´¨'))
  const fiberData = generateHistoricalData(getCurrentValue('è†³é£Ÿçº¤ç»´'))
  
  const option = {
    tooltip: {
      trigger: 'axis',
      axisPointer: {
        type: 'shadow'
      }
    },
    legend: {
      data: ['è›‹ç™½è´¨', 'ç¢³æ°´åŒ–åˆç‰©', 'è„‚è‚ª', 'ç»´ç”Ÿç´ ', 'çŸ¿ç‰©è´¨', 'è†³é£Ÿçº¤ç»´'],
      top: 'top',
      textStyle: {
        fontSize: 12
      }
    },
    grid: {
      left: '3%',
      right: '4%',
      bottom: '3%',
      containLabel: true
    },
    xAxis: {
      type: 'category',
      data: ['ä¸€æœˆå‰', 'ä¸‰å‘¨å‰', 'ä¸¤å‘¨å‰', 'ä¸Šå‘¨', 'æœ¬å‘¨'],
      axisLabel: {
        fontSize: 11
      }
    },
    yAxis: {
      type: 'value',
      min: 40,
      max: 100,
      axisLabel: {
        formatter: '{value}%'
      }
    },
    series: [
      {
        name: 'è›‹ç™½è´¨',
        type: 'line',
        smooth: true,
        emphasis: {
          focus: 'series'
        },
        data: proteinData,
        lineStyle: {
          width: 3
        },
        symbolSize: 8
      },
      {
        name: 'ç¢³æ°´åŒ–åˆç‰©',
        type: 'line',
        smooth: true,
        emphasis: {
          focus: 'series'
        },
        data: carbData,
        lineStyle: {
          width: 3
        },
        symbolSize: 8
      },
      {
        name: 'è„‚è‚ª',
        type: 'line',
        smooth: true,
        emphasis: {
          focus: 'series'
        },
        data: fatData,
        lineStyle: {
          width: 3
        },
        symbolSize: 8
      },
      {
        name: 'ç»´ç”Ÿç´ ',
        type: 'line',
        smooth: true,
        emphasis: {
          focus: 'series'
        },
        data: vitaminData,
        lineStyle: {
          width: 3
        },
        symbolSize: 8
      },
      {
        name: 'çŸ¿ç‰©è´¨',
        type: 'line',
        smooth: true,
        emphasis: {
          focus: 'series'
        },
        data: mineralData,
        lineStyle: {
          width: 3
        },
        symbolSize: 8
      },
      {
        name: 'è†³é£Ÿçº¤ç»´',
        type: 'line',
        smooth: true,
        emphasis: {
          focus: 'series'
        },
        data: fiberData,
        lineStyle: {
          width: 3
        },
        symbolSize: 8
      }
    ]
  }
  
  myChart.setOption(option)
  
  window.addEventListener('resize', () => {
    myChart.resize()
  })
}

// åˆå§‹åŒ–è¥å…»å½±å“å›¾
const initNutritionImpactChart = () => {
  const chartDom = document.getElementById('nutritionImpactChart')
  if (!chartDom) return
  
  const myChart = echarts.init(chartDom)
  
  // åŸºäºå½“å‰è¥å…»è¯„ä¼°åŠ¨æ€ç”Ÿæˆå½±å“æ•°æ®
  const avgNutritionScore = nutritionAssessment.value.reduce((sum, item) => sum + item.percentage, 0) / nutritionAssessment.value.length
  
  // åŸºäºå¹³å‡è¥å…»è¯„åˆ†è®¡ç®—å„å‘å±•å½±å“æŒ‡æ ‡
  const calculateImpact = (baseValue, nutritionCorrelation = 0.7) => {
    // è®¡ç®—åŸºç¡€å€¼åŠ ä¸Šä¸è¥å…»ç›¸å…³çš„æµ®åŠ¨å€¼
    const nutritionImpact = (avgNutritionScore - 70) * nutritionCorrelation
    return Math.round(Math.min(Math.max(baseValue + nutritionImpact, 60), 95))
  }
  
  // åŸºäºå¹´é¾„æ®µè¿›è¡Œè°ƒæ•´
  const ageFactors = {
    '6-9': { physical: 2, cognitive: 0, immune: 3, energy: 2, mood: 1, focus: -1 },
    '10-12': { physical: 3, cognitive: 1, immune: 2, energy: 3, mood: 0, focus: 0 },
    '13-15': { physical: 4, cognitive: 2, immune: 1, energy: 3, mood: -1, focus: 1 },
    '16-18': { physical: 3, cognitive: 3, immune: 0, energy: 2, mood: -2, focus: 2 }
  }
  
  const ageFactor = ageFactors[formData.ageRange] || ageFactors['6-9']
  
  // è®¡ç®—å„æŒ‡æ ‡çš„å€¼å’Œæ¯”ä¸Šå‘¨çš„æå‡
  const physicalValue = calculateImpact(78) + ageFactor.physical
  const cognitiveValue = calculateImpact(75) + ageFactor.cognitive
  const immuneValue = calculateImpact(80) + ageFactor.immune
  const energyValue = calculateImpact(76) + ageFactor.energy
  const moodValue = calculateImpact(72) + ageFactor.mood
  const focusValue = calculateImpact(74) + ageFactor.focus
  
  // è®¡ç®—ä¸"ä¸Šå‘¨"ç›¸æ¯”çš„æå‡
  const getImprovement = (value) => {
    return Math.floor(Math.random() * 5) + 5 // 5-10ä¹‹é—´çš„éšæœºæå‡
  }
  
  const option = {
    tooltip: {
      trigger: 'axis',
      axisPointer: {
        type: 'shadow'
      },
      formatter: function(params) {
        const data = params[0]
        return `${data.name}: ${data.value}%<br/>
                <small>ä¸æ ‡å‡†èœå•ç›¸æ¯” ${data.data.comparison > 0 ? '+' + data.data.comparison : data.data.comparison}%</small>`
      }
    },
    grid: {
      left: '3%',
      right: '4%',
      bottom: '8%',
      top: '3%',
      containLabel: true
    },
    xAxis: {
      type: 'value',
      max: 100,
      axisLabel: {
        formatter: '{value}%'
      }
    },
    yAxis: {
      type: 'category',
      data: ['èº«ä½“å‘è‚²', 'è®¤çŸ¥èƒ½åŠ›', 'å…ç–«åŠŸèƒ½', 'ç²¾åŠ›æ°´å¹³', 'æƒ…ç»ªç¨³å®šæ€§', 'æ³¨æ„åŠ›é›†ä¸­'],
      axisLabel: {
        fontSize: 12,
        margin: 20,
        formatter: function(value) {
          const icons = {
            'èº«ä½“å‘è‚²': 'ğŸ’ª',
            'è®¤çŸ¥èƒ½åŠ›': 'ğŸ§ ',
            'å…ç–«åŠŸèƒ½': 'ğŸ›¡ï¸',
            'ç²¾åŠ›æ°´å¹³': 'âš¡',
            'æƒ…ç»ªç¨³å®šæ€§': 'ğŸ˜Š',
            'æ³¨æ„åŠ›é›†ä¸­': 'ğŸ”'
          }
          return `${icons[value] || ''} ${value}`
        },
        rich: {
          icon: {
            fontSize: 16,
            padding: [0, 5, 0, 0]
          }
        }
      }
    },
    series: [
      {
        name: 'é¢„æœŸä¿ƒè¿›æ•ˆæœ',
        type: 'bar',
        data: [
          {value: physicalValue, comparison: getImprovement(physicalValue), itemStyle: {color: '#91cc75'}},
          {value: cognitiveValue, comparison: getImprovement(cognitiveValue), itemStyle: {color: '#5470c6'}},
          {value: immuneValue, comparison: getImprovement(immuneValue), itemStyle: {color: '#ee6666'}},
          {value: energyValue, comparison: getImprovement(energyValue), itemStyle: {color: '#fac858'}},
          {value: moodValue, comparison: getImprovement(moodValue), itemStyle: {color: '#73c0de'}},
          {value: focusValue, comparison: getImprovement(focusValue), itemStyle: {color: '#3ba272'}}
        ],
        label: {
          show: true,
          position: 'right',
          formatter: function(params) {
            return `${params.value}% ${params.data.comparison > 0 ? 'â†‘' : 'â†“'}${Math.abs(params.data.comparison)}%`
          }
        },
        emphasis: {
          itemStyle: {
            shadowBlur: 10,
            shadowOffsetX: 0,
            shadowColor: 'rgba(0, 0, 0, 0.5)'
          }
        },
        barWidth: '60%',
        barCategoryGap: '20%'
      }
    ]
  }
  
  myChart.setOption(option)
  
  window.addEventListener('resize', () => {
    myChart.resize()
  })
}

// åˆå§‹åŒ–æ»¡æ„åº¦å›¾è¡¨
const initSatisfactionChart = () => {
  const chartDom = document.getElementById('satisfactionChart')
  if (!chartDom) return
  
  const myChart = echarts.init(chartDom)
  
  // åŠ¨æ€ç”Ÿæˆæ»¡æ„åº¦åˆ†å¸ƒæ•°æ®ï¼ŒåŸºäºå¹³å‡è¥å…»è¯„åˆ†
  const avgNutritionScore = nutritionAssessment.value.reduce((sum, item) => sum + item.percentage, 0) / nutritionAssessment.value.length
  
  // æ»¡æ„åº¦åŸºç¡€å€¼éšè¥å…»è¯„åˆ†å‡é«˜
  const veryHappyBase = (avgNutritionScore - 70) * 0.7
  
  // è®¡ç®—æ»¡æ„åº¦åˆ†å¸ƒ
  const veryHappy = Math.min(Math.max(45 + veryHappyBase, 40), 60)
  const happy = Math.min(Math.max(95 - veryHappy, 30), 45)
  const neutral = Math.min(Math.max(100 - veryHappy - happy - 2, 3), 10)
  const unhappy = 100 - veryHappy - happy - neutral
  
  const option = {
    title: {
      text: 'é¢„æµ‹æ»¡æ„åº¦åˆ†å¸ƒ',
      left: 'center'
    },
    tooltip: {
      trigger: 'item',
      formatter: '{b}: {c}%'
    },
    legend: {
      orient: 'vertical',
      left: 'left',
      top: 'center'
    },
    series: [
      {
        name: 'æ»¡æ„åº¦',
        type: 'pie',
        radius: ['40%', '70%'],
        avoidLabelOverlap: false,
        itemStyle: {
          borderRadius: 10,
          borderColor: '#fff',
          borderWidth: 2
        },
        label: {
          show: false,
          position: 'center'
        },
        emphasis: {
          label: {
            show: true,
            fontSize: 16,
            fontWeight: 'bold'
          }
        },
        labelLine: {
          show: false
        },
        data: [
          { value: veryHappy.toFixed(1), name: 'éå¸¸æ»¡æ„' },
          { value: happy.toFixed(1), name: 'æ»¡æ„' },
          { value: neutral.toFixed(1), name: 'ä¸€èˆ¬' },
          { value: unhappy.toFixed(1), name: 'ä¸æ»¡æ„' }
        ]
      }
    ]
  }
  
  myChart.setOption(option)
  
  window.addEventListener('resize', () => {
    myChart.resize()
  })
}

// åˆå§‹åŒ–å‰©ä½™ç‡å›¾è¡¨
const initWasteRateChart = () => {
  const chartDom = document.getElementById('wasteRateChart')
  if (!chartDom) return
  
  const myChart = echarts.init(chartDom)
  
  // åŠ¨æ€ç”Ÿæˆå‰©ä½™ç‡æ•°æ®ï¼ŒåŸºäºè¥å…»è¯„åˆ†å’Œç‰¹æ®Šéœ€æ±‚
  const avgNutritionScore = nutritionAssessment.value.reduce((sum, item) => sum + item.percentage, 0) / nutritionAssessment.value.length
  
  // å‰©ä½™ç‡åŸºç¡€å€¼éšè¥å…»è¯„åˆ†é™ä½
  const wasteRateBase = 10 - (avgNutritionScore - 70) * 0.1
  
  // æ ¹æ®ç‰¹æ®Šéœ€æ±‚è°ƒæ•´
  let wasteRateAdjustment = 0
  if (formData.dietaryRequirements.length > 0) {
    // æœ‰ç‰¹æ®Šéœ€æ±‚æ—¶ï¼Œå‰©ä½™ç‡é™ä½ï¼ˆå› ä¸ºæ›´ç¬¦åˆéœ€æ±‚ï¼‰
    wasteRateAdjustment = -formData.dietaryRequirements.length * 0.5
  }
  
  // æ ¹æ®å¹´é¾„æ®µè°ƒæ•´å‰©ä½™ç‡
  const ageAdjustments = {
    '6-9': 1,    // å°å­¦ä½å¹´çº§å‰©ä½™è¾ƒå¤š
    '10-12': 0.5, // å°å­¦é«˜å¹´çº§
    '13-15': 0,   // åˆä¸­ç”Ÿ
    '16-18': -0.5 // é«˜ä¸­ç”Ÿæ›´å°‘æµªè´¹
  }
  
  const ageAdjustment = ageAdjustments[formData.ageRange] || 0
  
  // è®¡ç®—ä¸‰é¤å‰©ä½™ç‡
  const breakfastWaste = Math.max(Math.min(wasteRateBase + wasteRateAdjustment + ageAdjustment - 1, 10), 3).toFixed(1)
  const lunchWaste = Math.max(Math.min(wasteRateBase + wasteRateAdjustment + ageAdjustment + 1, 12), 4).toFixed(1)
  const dinnerWaste = Math.max(Math.min(wasteRateBase + wasteRateAdjustment + ageAdjustment, 11), 3.5).toFixed(1)
  const avgWaste = ((parseFloat(breakfastWaste) + parseFloat(lunchWaste) + parseFloat(dinnerWaste)) / 3).toFixed(1)
  
  const option = {
    title: {
      text: 'é£Ÿç‰©å‰©ä½™ç‡é¢„æµ‹',
      left: 'center'
    },
    tooltip: {
      trigger: 'axis',
      axisPointer: {
        type: 'shadow'
      }
    },
    grid: {
      left: '3%',
      right: '4%',
      bottom: '3%',
      containLabel: true
    },
    xAxis: {
      type: 'value',
      max: 15,
      axisLabel: {
        formatter: '{value}%'
      }
    },
    yAxis: {
      type: 'category',
      data: ['æ—©é¤', 'åˆé¤', 'æ™šé¤', 'å¹³å‡']
    },
    series: [
      {
        name: 'å‰©ä½™ç‡',
        type: 'bar',
        data: [
          {
            value: breakfastWaste,
            itemStyle: { color: '#91CC75' }
          },
          {
            value: lunchWaste,
            itemStyle: { color: '#FAC858' }
          },
          {
            value: dinnerWaste,
            itemStyle: { color: '#73C0DE' }
          },
          {
            value: avgWaste,
            itemStyle: { color: '#FC8452' },
            emphasis: {
              itemStyle: { color: '#FC8452' }
            }
          }
        ],
        label: {
          show: true,
          position: 'right',
          formatter: '{c}%'
        }
      }
    ]
  }
  
  myChart.setOption(option)
  
  window.addEventListener('resize', () => {
    myChart.resize()
  })
}
</script>

<style scoped>
/* å¼•å…¥è¿‡æ¸¡åŠ¨ç”» */
@import 'animate.css';

.menu-recommend-container {
  padding: 30px;
  width: 100%;
  max-width: 1600px;
  margin: 0 auto;
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  background-color: #f9fafc;
  min-height: 100vh;
  box-sizing: border-box;
}

/* é¡µé¢æ ‡é¢˜æ ·å¼ */
.header-section {
  text-align: center;
  margin-bottom: 40px;
  animation: fadeInDown 1s ease;
  padding: 30px 20px;
  position: relative;
  overflow: hidden;
  border-radius: 20px;
  background: linear-gradient(135deg, rgba(66, 185, 131, 0.1) 0%, rgba(62, 175, 124, 0.2) 100%);
  box-shadow: 0 10px 30px rgba(62, 175, 124, 0.1);
}

.ai-data-badge {
  position: absolute;
  top: 15px;
  right: 15px;
  display: flex;
  align-items: center;
  padding: 6px 12px;
  background: linear-gradient(135deg, #3b7cbd 0%, #1a5fb4 100%);
  border-radius: 20px;
  color: white;
  font-weight: 600;
  font-size: 0.9rem;
  box-shadow: 0 4px 10px rgba(26, 95, 180, 0.3);
  z-index: 10;
}

.badge-icon {
  margin-right: 6px;
  font-size: 1.2rem;
}

.data-indicators {
  display: flex;
  justify-content: center;
  align-items: center;
  margin-top: 20px;
  padding: 10px;
  background-color: rgba(255, 255, 255, 0.8);
  border-radius: 12px;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
}

.indicator {
  text-align: center;
  padding: 0 15px;
}

.indicator-value {
  font-size: 1.4rem;
  font-weight: 700;
  color: #3b7cbd;
  margin-bottom: 5px;
}

.indicator-label {
  font-size: 0.85rem;
  color: #5d6778;
}

.indicator-divider {
  width: 1px;
  height: 40px;
  background-color: rgba(0, 0, 0, 0.1);
}

.header-section::before {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: linear-gradient(
    135deg,
    rgba(255, 255, 255, 0) 0%,
    rgba(255, 255, 255, 0.1) 25%,
    rgba(255, 255, 255, 0.1) 50%,
    rgba(255, 255, 255, 0) 75%,
    rgba(255, 255, 255, 0) 100%
  );
  transform: rotate(45deg);
  animation: shimmer 5s infinite linear;
  z-index: 1;
}

.page-title, .subtitle {
  position: relative;
  z-index: 2;
}

.page-title {
  font-size: 2.2rem;
  font-weight: 700;
  color: #2c3e50;
  margin-bottom: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-wrap: wrap;
}

.title-icon {
  font-size: 2.5rem;
  margin-right: 15px;
}

.subtitle {
  font-size: 1.2rem;
  color: #5d6778;
  font-weight: 400;
}

/* å¡ç‰‡æ ·å¼ä¼˜åŒ– */
.param-card, .process-card, .menu-card, .chart-card, .nutrition-assessment-card, .feedback-card {
  border-radius: 16px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
  transition: all 0.3s ease;
  border: none;
  overflow: hidden;
  backdrop-filter: blur(10px);
  background-color: rgba(255, 255, 255, 0.95);
}

.param-card:hover, .process-card:hover, .menu-card:hover, .chart-card:hover, 
.nutrition-assessment-card:hover, .feedback-card:hover {
  box-shadow: 0 12px 30px rgba(149, 157, 165, 0.25);
  transform: translateY(-3px);
}

/* å¡ç‰‡å¤´éƒ¨æ ·å¼ */
.card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 18px 20px;
  background: linear-gradient(135deg, #42b983 0%, #3eaf7c 100%);
  color: white;
  position: relative;
  overflow: hidden;
}

.card-header::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect x="0" y="0" width="50" height="50" fill="rgba(255,255,255,0.03)"/><rect x="50" y="50" width="50" height="50" fill="rgba(255,255,255,0.03)"/></svg>');
  opacity: 0.3;
}

.header-left {
  display: flex;
  align-items: center;
  position: relative;
  z-index: 1;
}

.header-icon {
  margin-right: 10px;
  font-size: 1.3rem;
  filter: drop-shadow(0 2px 3px rgba(0, 0, 0, 0.2));
}

.header-tag {
  font-weight: 500;
}

/* å‚æ•°è¡¨å•æ ·å¼ */
.param-form {
  padding: 10px;
}

.custom-select {
  width: 100%;
  transition: all 0.3s ease;
}

.custom-select:hover {
  transform: translateY(-2px);
}

.select-option-with-icon,
.checkbox-with-icon,
.radio-with-icon {
  display: flex;
  align-items: center;
  gap: 8px;
}

.option-icon,
.checkbox-icon,
.radio-icon {
  font-size: 1.2rem;
}

.checkbox-group-vertical {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.custom-radio-group {
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.custom-radio {
  margin-right: 0 !important;
  margin-bottom: 10px;
}

/* ç”ŸæˆæŒ‰é’®æ ·å¼ */
.generate-btn {
  padding: 14px 35px;
  font-size: 1.05rem;
  border-radius: 50px;
  margin-top: 20px;
  background: linear-gradient(135deg, #1a6fc7 0%, #2a81d7 100%);
  border: none;
  transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 12px;
  position: relative;
  overflow: hidden;
  box-shadow: 0 10px 20px rgba(42, 129, 215, 0.25);
}

.generate-btn::after {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: linear-gradient(
    135deg,
    rgba(255, 255, 255, 0) 0%,
    rgba(255, 255, 255, 0.2) 50%,
    rgba(255, 255, 255, 0) 100%
  );
  transform: rotate(45deg);
  transition: all 0.3s ease;
  opacity: 0;
}

.generate-btn:hover {
  transform: translateY(-5px) scale(1.03);
  box-shadow: 0 15px 30px rgba(42, 129, 215, 0.3);
}

.generate-btn:hover::after {
  animation: button-shimmer 1.5s infinite;
  opacity: 1;
}

@keyframes button-shimmer {
  0% {
    transform: translate(-50%, -50%) rotate(45deg);
  }
  100% {
    transform: translate(50%, 50%) rotate(45deg);
  }
}

.btn-icon {
  font-size: 1.2rem;
}

/* å¤„ç†æ­¥éª¤æ ·å¼ */
.processing-badge {
  display: flex;
  align-items: center;
  background-color: rgba(255, 255, 255, 0.2);
  padding: 5px 10px;
  border-radius: 30px;
  font-size: 0.8rem;
  font-weight: 500;
}

.badge-dot {
  height: 8px;
  width: 8px;
  border-radius: 50%;
  background-color: #fff;
  margin-right: 6px;
  animation: pulse 1.5s infinite;
}

.custom-timeline {
  padding: 20px;
}

.step-content {
  background-color: #fff;
  border-radius: 10px;
  padding: 15px;
  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.05);
  transition: all 0.3s ease;
}

.step-content:hover {
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
  transform: translateY(-2px);
}

.step-title {
  font-weight: 700;
  font-size: 1.1rem;
  margin-bottom: 8px;
  color: #2c3e50;
  display: flex;
  align-items: center;
  gap: 10px;
}

.step-number {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 24px;
  height: 24px;
  border-radius: 50%;
  background-color: #2a81d7;
  color: white;
  font-size: 0.8rem;
}

.step-description {
  color: #5d6778;
  font-size: 0.95rem;
  line-height: 1.5;
}

.custom-progress {
  height: 12px;
  border-radius: 6px;
  box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
  overflow: hidden;
}

/* èœå•å±•ç¤ºæ ·å¼ */
.menu-section {
  margin-top: 30px;
}

.menu-date-header {
  display: flex;
  align-items: center;
  margin-bottom: 20px;
  padding: 0 15px;
}

.date-icon {
  font-size: 1.8rem;
  margin-right: 10px;
}

.menu-date {
  font-size: 1.3rem;
  font-weight: 600;
  color: #2c3e50;
}

.meal-card {
  overflow: hidden;
  border-radius: 16px;
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.06);
  transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  position: relative;
  border: 1px solid rgba(230, 230, 230, 0.5);
  backdrop-filter: blur(5px);
}

.meal-card:hover {
  transform: translateY(-8px) scale(1.02);
  box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
}

.meal-card-bg {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: 0;
  opacity: 0.5;
}

.meal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  position: relative;
  z-index: 1;
}

.meal-title {
  display: flex;
  align-items: center;
  gap: 8px;
}

.meal-icon {
  font-size: 1.3rem;
}

.meal-time-tag {
  font-weight: 500;
}

.meal-content {
  padding: 15px;
  position: relative;
  z-index: 1;
}

.dish-item {
  display: flex;
  align-items: center;
  margin-bottom: 15px;
  padding: 10px;
  background-color: rgba(255, 255, 255, 0.9);
  border-radius: 12px;
  transition: all 0.3s ease;
  border: 1px solid rgba(240, 240, 240, 0.8);
}

.dish-item:hover {
  transform: translateX(8px);
  background-color: white;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
  border-color: rgba(220, 220, 220, 0.8);
}

.dish-icon-wrapper {
  width: 50px;
  height: 50px;
  border-radius: 25px;
  display: flex;
  justify-content: center;
  align-items: center;
  margin-right: 15px;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
  transform: rotate(-5deg);
  transition: all 0.3s ease;
}

.dish-item:hover .dish-icon-wrapper {
  transform: rotate(0) scale(1.1);
}

.dish-icon {
  font-size: 28px;
  filter: drop-shadow(0 2px 3px rgba(0, 0, 0, 0.2));
}

.dish-details {
  flex: 1;
}

.dish-name {
  font-weight: 600;
  margin-bottom: 5px;
  color: #333;
  font-size: 0.95rem;
}

.nutrition-tag {
  border-radius: 12px;
  padding: 0 8px;
  font-size: 0.75rem;
}

.week-menu-tabs {
  min-height: 450px;
}

.week-tab-label {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 0;
}

.day-icon {
  font-size: 1.2rem;
}

.export-btn {
  display: flex;
  align-items: center;
  gap: 7px;
  font-weight: 500;
}

/* è¥å…»é›·è¾¾å›¾åˆ†ææ ·å¼ */
.nutrition-section {
  margin-top: 30px;
}

.chart-card, .nutrition-assessment-card {
  height: 100%;
}

.ai-badge {
  padding: 3px 6px;
  border-radius: 4px;
  background-color: rgba(255, 255, 255, 0.2);
}

.chart-container {
  padding: 20px;
}

.chart-info {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 15px;
  padding: 0 15px;
}

.info-item {
  display: flex;
  align-items: center;
  gap: 8px;
}

.info-icon {
  font-size: 1.2rem;
}

.info-text {
  font-weight: 600;
  color: #5d6778;
}

.info-divider {
  width: 1px;
  height: 30px;
  background-color: #e0e0e0;
}

.legend-container {
  display: flex;
  gap: 15px;
}

.legend-item {
  display: flex;
  align-items: center;
  gap: 5px;
}

.legend-color {
  width: 15px;
  height: 15px;
  border-radius: 3px;
  background-color: rgba(58, 162, 254, 0.3);
}

.legend-dashed {
  border: 2px dashed #5470c6;
  background-color: transparent;
}

.legend-dotted {
  border: 2px dotted #91cc75;
  background-color: transparent;
}

.legend-label {
  font-size: 0.8rem;
  color: #606266;
}

.radar-chart {
  margin-top: 15px;
}

.assessment-score {
  background-color: rgba(255, 255, 255, 0.2);
  padding: 5px 10px;
  border-radius: 20px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.score-label {
  font-size: 0.8rem;
}

.score-value {
  font-size: 1.1rem;
  font-weight: 700;
}

.nutrition-assessment {
  padding: 20px;
}

.nutrition-trend-container, .nutrition-impact-container {
  margin-top: 20px;
  padding: 15px;
  background-color: #f8f9fb;
  border-radius: 10px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
}

.trend-header, .impact-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
}

.trend-info-icon {
  color: #909399;
  cursor: pointer;
  transition: color 0.3s;
}

.trend-info-icon:hover {
  color: #409EFF;
}

.trend-chart, .impact-chart {
  border-radius: 8px;
  overflow: hidden;
  background-color: white;
  box-shadow: 0 1px 5px rgba(0, 0, 0, 0.05);
}

.nutrition-item {
  margin-bottom: 20px;
  padding: 15px;
  background-color: #fff;
  border-radius: 10px;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
  transition: all 0.3s ease;
}

.nutrition-item:hover {
  transform: translateY(-3px);
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
}

.nutrition-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
}

.nutrition-name-wrapper {
  display: flex;
  align-items: center;
  gap: 8px;
}

.nutrition-icon {
  font-size: 1.2rem;
}

.nutrition-name {
  font-weight: 600;
  color: #333;
}

.status-tag {
  font-weight: 500;
}

.nutrition-progress {
  margin-bottom: 5px;
}

.progress-info {
  display: flex;
  justify-content: space-between;
  margin-bottom: 10px;
}

.progress-value {
  font-weight: 600;
  color: #333;
}

.progress-label {
  color: #909399;
  font-size: 0.85rem;
}

.nutrition-description {
  font-size: 0.85rem;
  color: #606266;
  line-height: 1.5;
}

.ai-suggestion-header {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 10px;
}

.ai-icon {
  font-size: 1.5rem;
}

.ai-suggestion {
  background-color: #f0f9eb;
  border-radius: 10px;
  padding: 15px;
  font-size: 0.95rem;
  color: #5d6778;
  line-height: 1.6;
  border-left: 4px solid #67c23a;
}

.adjust-btn-container {
  display: flex;
  justify-content: flex-end;
}

.adjust-btn {
  display: flex;
  align-items: center;
  gap: 6px;
  font-weight: 500;
}

/* å­¦ç”Ÿåé¦ˆé¢„æµ‹æ ·å¼ */
.feedback-prediction {
  padding: 20px;
}

.chart-wrapper {
  height: 100%;
  padding: 15px;
  background-color: white;
  border-radius: 10px;
  box-shadow: 0 3px 12px rgba(0, 0, 0, 0.05);
}

.chart-title {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 15px;
}

.chart-icon {
  font-size: 1.3rem;
}

.chart-title h4 {
  font-weight: 600;
  color: #2c3e50;
  margin: 0;
}

.prediction-summary {
  height: 100%;
  padding: 20px;
  background-color: #f9f9f9;
  border-radius: 10px;
  box-shadow: 0 3px 12px rgba(0, 0, 0, 0.05);
}

.summary-header {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 15px;
}

.summary-icon {
  font-size: 1.3rem;
}

.prediction-items {
  margin-bottom: 20px;
}

.prediction-item {
  display: flex;
  align-items: flex-start;
  gap: 10px;
  margin-bottom: 12px;
  padding: 8px;
  border-radius: 8px;
  background-color: white;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
  transition: all 0.3s ease;
  animation: fadeInRight 0.6s ease;
}

.prediction-item:hover {
  transform: translateX(5px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
}

.prediction-item i {
  color: #409EFF;
  margin-top: 3px;
}

.history-comparison {
  border-top: 1px dashed #dcdfe6;
  padding-top: 15px;
}

.comparison-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
  font-weight: 600;
}

.improvement-tag {
  font-weight: 500;
}

.improvement-chart {
  margin-bottom: 15px;
}

.chart-bar-container {
  display: flex;
  align-items: center;
  margin-bottom: 10px;
}

.chart-label {
  width: 50px;
  font-size: 0.85rem;
  color: #606266;
}

.chart-bar {
  height: 24px;
  border-radius: 12px;
  position: relative;
  padding-right: 10px;
  display: flex;
  align-items: center;
  justify-content: flex-end;
  font-size: 0.8rem;
  font-weight: 500;
  color: white;
  transition: width 1s ease;
  animation: growWidth 1.2s ease;
}

.current {
  background: linear-gradient(90deg, #42b983 0%, #67c23a 100%);
}

.previous {
  background: linear-gradient(90deg, #409eff 0%, #66b1ff 100%);
}

.average {
  background: linear-gradient(90deg, #909399 0%, #c0c4cc 100%);
}

.bar-value {
  white-space: nowrap;
}

.comparison-text {
  font-size: 0.9rem;
  color: #606266;
  line-height: 1.5;
}

/* è¿‡æ¸¡åŠ¨ç”» */
.fade-up-enter-active,
.fade-up-leave-active {
  transition: all 0.5s ease-out;
}

.fade-up-enter-from {
  opacity: 0;
  transform: translateY(20px);
}

.fade-up-leave-to {
  opacity: 0;
  transform: translateY(-20px);
}

/* è„‰å†²åŠ¨ç”» */
@keyframes pulse {
  0% {
    opacity: 0.5;
    transform: scale(0.8);
  }
  50% {
    opacity: 1;
    transform: scale(1.2);
  }
  100% {
    opacity: 0.5;
    transform: scale(0.8);
  }
}

/* å®½åº¦å¢é•¿åŠ¨ç”» */
@keyframes growWidth {
  from {
    width: 0;
  }
  to {
    width: var(--width, 100%);
  }
}

@keyframes shimmer {
  0% {
    transform: translate(-50%, -50%) rotate(45deg);
  }
  100% {
    transform: translate(50%, 50%) rotate(45deg);
  }
}

/* AIå¤„ç†æ­¥éª¤æ ·å¼ */
.ai-processing-step .step-content {
  position: relative;
  overflow: hidden;
  border-left: 3px solid #3b7cbd;
}

.ai-step-indicator {
  position: absolute;
  top: 10px;
  right: 10px;
  display: flex;
  align-items: center;
  padding: 5px 10px;
  background-color: rgba(59, 124, 189, 0.1);
  border-radius: 20px;
  animation: pulse 2s infinite;
}

.ai-processing-dots {
  display: flex;
}

.ai-processing-dots span {
  width: 6px;
  height: 6px;
  margin: 0 2px;
  background-color: #3b7cbd;
  border-radius: 50%;
  animation: dotPulse 1.5s infinite;
}

.ai-processing-dots span:nth-child(2) {
  animation-delay: 0.2s;
}

.ai-processing-dots span:nth-child(3) {
  animation-delay: 0.4s;
}

.ai-step-label {
  margin-left: 5px;
  font-size: 0.75rem;
  color: #3b7cbd;
  font-weight: 600;
}

.ai-step-completed {
  position: absolute;
  top: 10px;
  right: 10px;
  display: flex;
  align-items: center;
  padding: 5px 10px;
  background-color: rgba(103, 194, 58, 0.1);
  border-radius: 20px;
}

.ai-step-icon {
  color: #67c23a;
  font-weight: bold;
}

.progress-stats {
  display: flex;
  justify-content: space-between;
  margin-bottom: 8px;
  font-size: 0.75rem;
}

.stat-item {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.stat-label {
  color: #909399;
}

.stat-value {
  font-weight: 600;
  color: #3b7cbd;
}

.progress-percentage {
  text-align: center;
  font-weight: 600;
  color: #3b7cbd;
  margin-top: 5px;
  font-size: 0.9rem;
}

.data-flow-visual {
  height: 30px;
  margin-top: 10px;
  position: relative;
  overflow: hidden;
  background-color: rgba(59, 124, 189, 0.05);
  border-radius: 4px;
}

.data-flow-line {
  position: absolute;
  height: 2px;
  width: 40px;
  background: linear-gradient(90deg, rgba(59, 124, 189, 0) 0%, #3b7cbd 50%, rgba(59, 124, 189, 0) 100%);
  top: calc(50% - 1px);
  animation: dataFlow 3s infinite linear;
}

/* AIåˆ†ææ ‡è¯† */
.ai-analyze-badge {
  display: flex;
  align-items: center;
  padding: 5px 10px;
  background-color: rgba(255, 255, 255, 0.2);
  border-radius: 20px;
}

.ai-icon {
  margin-right: 5px;
}

.ai-text {
  font-size: 0.85rem;
  font-weight: 600;
}

/* å®æ—¶æ•°æ®åˆ†ææŒ‡ç¤ºå™¨ */
.data-analysis-indicators {
  display: flex;
  align-items: center;
}

.indicator-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background-color: #67c23a;
  margin-right: 8px;
  position: relative;
}

.indicator-dot::after {
  content: '';
  position: absolute;
  top: -2px;
  left: -2px;
  right: -2px;
  bottom: -2px;
  border-radius: 50%;
  background-color: rgba(103, 194, 58, 0.4);
  animation: pulse 2s infinite;
}

.analysis-indicator-text {
  font-size: 0.8rem;
  color: #67c23a;
  font-weight: 600;
  margin-right: 10px;
}

.realtime-data-banner {
  display: flex;
  justify-content: space-between;
  padding: 8px 12px;
  background-color: rgba(255, 255, 255, 0.8);
  border-radius: 8px;
  margin-bottom: 10px;
  font-size: 0.75rem;
  color: #606266;
}

.ai-model-info {
  font-weight: 600;
  color: #3b7cbd;
}

@keyframes dotPulse {
  0%, 100% {
    opacity: 0.4;
    transform: scale(0.8);
  }
  50% {
    opacity: 1;
    transform: scale(1.2);
  }
}

@keyframes dataFlow {
  0% {
    transform: translateX(-100%);
  }
  100% {
    transform: translateX(400%);
  }
}

/* å¤§æ•°æ®å¤„ç†æŒ‡æ ‡å’Œè§†è§‰å…ƒç´ æ ·å¼ */
.data-stats-badge {
  display: flex;
  align-items: center;
  background-color: rgba(255, 255, 255, 0.2);
  padding: 5px 10px;
  border-radius: 30px;
  font-size: 0.8rem;
  font-weight: 500;
}

.stats-item {
  display: flex;
  align-items: center;
  gap: 5px;
}

.stats-value {
  font-weight: 700;
  color: #fff;
}

.stats-divider {
  width: 1px;
  height: 16px;
  background-color: rgba(255, 255, 255, 0.5);
  margin: 0 8px;
}

.big-data-metrics {
  display: flex;
  justify-content: space-between;
  background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
  border-radius: 12px;
  padding: 15px;
  margin-bottom: 20px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
}

.data-metric {
  text-align: center;
  padding: 0 15px;
}

.metric-icon {
  font-size: 1.5rem;
  margin-bottom: 8px;
}

.metric-value {
  font-size: 1.2rem;
  font-weight: 700;
  color: #2d3748;
  margin-bottom: 5px;
}

.metric-label {
  font-size: 0.8rem;
  color: #718096;
}

.data-source-list {
  margin-bottom: 20px;
  background-color: #f8fafc;
  border-radius: 12px;
  padding: 15px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

.source-header {
  display: flex;
  justify-content: space-between;
  margin-bottom: 10px;
  padding-bottom: 8px;
  border-bottom: 1px solid #e2e8f0;
  font-weight: 600;
  color: #4a5568;
}

.source-items {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  gap: 10px;
}

.source-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 12px;
  background-color: white;
  border-radius: 8px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
}

.source-name {
  font-weight: 500;
  color: #2d3748;
}

.source-records {
  margin-left: 8px;
  font-size: 0.75rem;
  color: #718096;
  font-weight: 400;
}

.source-status {
  display: flex;
  align-items: center;
  gap: 5px;
}

.status-indicator {
  width: 8px;
  height: 8px;
  border-radius: 50%;
}

.status-indicator.active {
  background-color: #68d391;
  box-shadow: 0 0 0 2px rgba(104, 211, 145, 0.3);
  animation: pulse 2s infinite;
}

.status-indicator.connecting {
  background-color: #f6ad55;
}

.status-text {
  font-size: 0.75rem;
  color: #718096;
}

.big-data-indicators {
  margin: 10px 0;
  display: flex;
  justify-content: space-between;
}

.data-processing-visual {
  display: flex;
  flex-wrap: wrap;
  gap: 5px;
  max-width: 60%;
}

.data-node {
  width: 12px;
  height: 12px;
  border-radius: 2px;
  background-color: #e2e8f0;
  transition: all 0.3s ease;
}

.data-node.node-active {
  background-color: #4299e1;
  transform: scale(1.1);
  animation: nodePulse 1.5s infinite;
}

.data-metrics {
  font-size: 0.75rem;
}

.metric-row {
  display: flex;
  justify-content: space-between;
  margin-bottom: 5px;
}

.big-data-visual {
  margin-top: 12px;
  padding: 10px;
  background-color: rgba(66, 153, 225, 0.05);
  border-radius: 8px;
}

.data-container {
  display: flex;
  flex-wrap: wrap;
  gap: 3px;
  margin-bottom: 8px;
}

.data-block {
  width: 10px;
  height: 10px;
  background-color: #e2e8f0;
  border-radius: 2px;
  transition: background-color 0.5s ease;
}

.data-block.block-processed {
  background-color: #4299e1;
}

.processing-stats {
  display: flex;
  justify-content: space-around;
  margin-top: 10px;
  font-size: 0.75rem;
}

.stat {
  text-align: center;
}

.stat-name {
  color: #718096;
  margin-bottom: 3px;
}

.stat-value {
  font-weight: 600;
  color: #2d3748;
}

@keyframes nodePulse {
  0%, 100% {
    opacity: 0.7;
    transform: scale(1);
  }
  50% {
    opacity: 1;
    transform: scale(1.2);
  }
}
</style>